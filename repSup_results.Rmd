---
title: 'Revealing neural mechanisms of repetition suppression using a voxel-wise background connectivity analysis'
author: "Korea Brain Research Institute, Cognitive Science Research Group, Deep Memory Lab"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    highlight: tango
    number_sections: true
    theme: cosmo
    toc: true
    toc_depth: 5
    toc_float:
      collapse: false
      smooth_scroll: false
  pdf_document:
    toc: true
    toc_depth: 5
subtitle: Repetition Suppression & Background Functional Connectivity
mainfont: Noto Sans CJK KR
editor_options: 
  chunk_output_type: console
---
  
```{r, echo=FALSE}
rm(list=ls())
# getwd()
setwd("/Users/taehoonkim/Desktop/Workspace/git_project/repSup_R")
options(scipen=4)
```

```{css, echo=FALSE}
pre code, pre, code {
  white-space: pre !important;
  overflow-x: scroll !important;
  word-break: keep-all !important;
  word-wrap: initial !important;
}
```


```{r setup, message=FALSE}
set.seed(12345) # for reproducibility
options(knitr.kable.NA = '')

# install // load packages 
# Some packages need to be loaded. 
# We use `pacman` as a package manager, which takes care of the other packages. 
if (!require("devtools", quietly = TRUE)) install.packages("devtools")
if (!require("papaja", quietly = TRUE)) devtools::install_github("crsh/papaja")
if (!require("patchwork", quietly = TRUE)) devtools::install_github("thomasp85/patchwork")
if (!require("klippy", quietly = TRUE)) devtools::install_github("RLesur/klippy")
if (!require("pacman", quietly = TRUE)) install.packages("pacman")
if (!require("Rmisc", quietly = TRUE)) install.packages("Rmisc")
if (!require("ggbeeswarm", quietly = TRUE)) install.packages("ggbeeswarm") # Never load it directly.
pacman::p_load(tidyverse, papaja, knitr, dplyr, car, psych, afex, lme4, lmerTest, 
               emmeans, ggplot2, ggpubr, lattice, latticeExtra, parallel, effects, psycho, caret)
library("patchwork"); library("klippy")
klippy::klippy()
```

# Abstract

<br>

이 분석은 Repetition Suppression / Enhancement의 신경 기제를 Voxel-wise Background Connectivity를 통해 살펴보는 것에 초점을 맞추고 있다.
구체적으로, Repetition Suppression / Enhancement를 설명하는 서로 다른 두 가지 모델. Sharpening Model과 Predictive Coding Model을 비교하고자 한다. 

<br>

**Repetition suppression과 enhancement**
* 반복되는 대상에 대한 신경 활성화의 감소(Suppression) 및 증가(Enhancement)
* 일반적으로 대상 영역의 전체 voxel 중 RS voxel은 75%, RE voxel은 25%의 비율로 나타난다.
* 친숙하지 않은 대상, 알아보기 힘든 대상한테는 RS보다 RE가 발생, 또는 RS의 효과 감소하는 모습을 보인다.

<br>

**Sharpening Account**
* 반복은 대상의 표상에 덜 관련성이 있는 neural population의 반응을 감소시킨다 
* 대상을 처음 표상할때는 대상에 관련이 있는, tuning된 neural population 뿐만 아니라 그렇지 않은 neural population도 함께 반응하게 된다.
* repetition이 발생하면 tuning되지 않은 neural population들의 반응이 감소하면서 전체적으로 RS가 발생한다.
* RS는 Sharpening에 의해 selectivity가 적은 neural population의 반응 감소를 반영하며 RE는 미처 Sharpening되지 않은 population이나 대상을 표상하는데 selectivity를 가지고 있는 neural population의 반응 증가를 반영한다.
* 이에 따르면, RS를 보이는 voxel들은 RE를 보이는 voxel들 보다 대상을 표상하는데 관련성이 적은 voxel들일 수 있다. 즉, RS보다 RE가 중요하다.

<br>

**Predictive Coding Account**
* 우리의 뇌는 감각 입력을 예측하기 위해 기억에 기반한 맥락과 정보로 외부 환경에 대한 모델을 생성한다.
* 상위 영역에서는 기억에 기반하여 Prediction을 생성하고, Feedback을 통해 하위 감각 영역으로 전달된다. 
* 반대로 하위 영역에서는 Prediction과 실제 Sensory input을 비교하여 둘 간의 Mismatch를 Prediction error signal로 부호화하고, 상위 영역으로 Feedforward한다. 이러한 상호작용을 통해 모델을 지속적으로 갱신할 수 있다.
* Repetition은 대상에 대한 Prediction을 형성하는데 영향을 준다. Repetition이 더 많이 일어날수록, 상위 영역에서 더 정교한 Prediction이 형성되며 하위 영역에서의 Error signal이 감소한다. 
* RS는 정교한 Prediction에 의해 Error signal이 감소되는 것을 반영한다. RE는 Prediction에 대한 Error signal의 증가를 반영한다.
* 다른 측면에서 보면, RS는 Prediction을 주로 받는 population, RE는 Prediction Error Signal을 주로 생성하는 population일 수 있다.
* 이에 따르면, RS와 RE는 서로 다른 functional role을 가진다. Sharpening에서 제안하는 것처럼 RS가 대상을 표상하는데 관련성이 적은 voxel들인 것은 아니다. 오히려 대상을 표상하는 중요한 representation unit일 가능성이 크다. 
 
<br>

* RS voxel과 RE voxel 중 어떤 것이 대상을 표상하는 데 더 중요한 정보를 많이 가지고 있는가? 어떤 모델이 더 적절할까?
* Sharpening 모델에 따르면 RS는 불필요한 신경 신호를 반영하므로 RS 보다 RE가 대상의 표상에 더 중요한 정보를 가지고 있어야 한다.
* 반면, PC 모델에 따르면 RS는 Prediction, Representation, RE는 Error signal을 반명하므로 RE 보다 RS가 중요한 정보를 가지고 있어야 한다.

<br>

* 이 질문은 두 가지 방식으로 검증할 수 있다.
1. Deep learning 기법을 사용. RS voxel과 RE voxel을 나누어 얼굴 표상 재구성에 중요도를 평가한다.
2. Voxel-wise Background Connectivity를 사용. Repetition Suppression의 효과와 상위 영역과의 연결성 간 상호작용을 검증한다. 추가로 RS voxel/RE voxel과 상위 영역 간의 연결성을 평가한다.

<br> 

* 이 분석에서는 2번째 방법을 사용한다.  가설은 다음과 같다. 
1. Sharpening. 대상을 표상하는 데 RS보다 RE가 중요. 중요한 voxel들은 상위 영역과 연결성이 클 가능성이 있음. RS는 불필요하므로 상위 영역과 연결성이 낮은데, RE는 중요하므로 상위 영역과 연결성이 높아야함.
2. PC. RS는 Prediction & Representation, RE는 Error Signal을 반영하므로 RS가 대상 표상에 중요. RS는 상위 영역과 연결성이 높은 반면, RE는 연결성이 낮을 것임.


<br><br>

****

# Results 1 - Repetition Suppression Effect & bgFC
  
<br>
  
## FFA/PPA - VC Background Connectivity (Phase 1)

<br>
  
Phase 1에서 추출한 FFA ROI과 fBGRED 참가자들의 좌표로 만든 PPA ROI가 제대로 추출되었는지 확인하기 위해 Phase 1에서 FFA/PPA-VC Background Conectivity를 비교하였다. Phase 1에서 참가자들이 본 이미지 자극들은 모두 얼굴이므로, ROI Localizing이 잘 되었다면, PPA-VC bgFC 보다 FFA-VC bgFC가 더 강하게 나타나야한다.

<br><br>
  
```{r, collapse=TRUE}

t2 <- read.csv("data/bg_summary_nsm.csv", header = T)
t2_l <- gather(t2, hRoi, fc, ppa:ffa, factor_key=TRUE)
t2_l$subj = factor(t2_l$subj, levels=c("primeRecon_2", "primeRecon_4", 
                                       "primeRecon_5", "primeRecon_6",
                                       "primeRecon_7", "primeRecon_8", 
                                       "primeRecon_9", "primeRecon_10",
                                       "primeRecon_11", "primeRecon_13",
                                       "primeRecon_14", "primeRecon_15",
                                       "primeRecon_16", "primeRecon_17",
                                       "primeRecon_18", "primeRecon_19",
                                       "primeRecon_20", "primeRecon_21",
                                       "primeRecon_22", "primeRecon_23",
                                       "primeRecon_24"), 
                   labels=c(2,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24))


t2_l <- t2_l %>% filter(subj!=99)
t2_l$vRoi = factor(t2_l$vROIs, levels=c("v1","v2","v3","v4","all"),
                   labels=c("v1","v2","v3","v4","v_all")) 
t2_l$hRoi = factor(t2_l$hRoi, levels=c("ppa","ffa")) 
t2_l <- t2_l %>% select(subj,hRoi,vRoi,fc)

# number of subject
length(unique(t2$subj))

# variables
glimpse(t2_l, width = 70)

```

<br>

각 시각 영역과 상위 영역 간 Background Connectivity 결과의 요약치는 아래와 같다.

<br>

```{r, collapse=TRUE}

# subject-level, long format
t2_allL <- t2_l %>% group_by(subj, vRoi, hRoi) %>%
  dplyr::summarise(fc=mean(fc)) %>%
  ungroup()
# t2_allL %>% kable(digits=2)

# subject-level, wide format
t2_allW <- t2_allL %>% spread(key=hRoi, value = fc)
# t2_allW %>% kable(digits=2)

# summary table: grand mean
t2_allG <- t2_allL %>% group_by(vRoi, hRoi) %>%
  summarise(fc.m = mean(fc), fc.sd = sd(fc)) %>%
  ungroup()
t2_allG$fc.se <- Rmisc::summarySEwithin(data = t2_allL, measurevar = "fc", 
                                        idvar = "subj", withinvars = c("vRoi", "hRoi"))$se
t2_allG$fc.ci <- Rmisc::summarySEwithin(data = t2_allL, measurevar = "fc", 
                                        idvar = "subj", withinvars = c("vRoi", "hRoi"))$ci
t2_allG <- t2_allG %>% 
  mutate(lower.ci = fc.m-fc.ci,
         upper.ci = fc.m+fc.ci,
         lower.se = fc.m-fc.se,
         upper.se = fc.m+fc.se)
# for between-subject design. check help(summarySE)
t2_allG<-t2_allG %>% select(vRoi, hRoi, fc.m, fc.sd, fc.se, fc.ci, lower.ci, upper.ci, lower.se, upper.se)
t2_allG %>% select(vRoi, hRoi, fc.m) %>% spread(hRoi, fc.m) %>% kable(digits=2)

```

<br>

아래 그래프는 각 시각 영역과 상위 영역 간의 Background Connectivity (Zr)를 나타낸다. 점은 평균, error bar는 95% ci를 나타내었다.

<br>

```{r, fig.width= 12, fig.height=6}
t2.all.plot2 <- ggplot(data=t2_allL, aes(x=vRoi, y=fc, fill=hRoi)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  
  geom_segment(data=filter(t2_allW, vRoi == "v1"), inherit.aes = FALSE,
               aes(x=0.80, y=filter(t2_allW, vRoi == "v1")$ppa,
                   xend=1.20, yend=filter(t2_allW, vRoi == "v1")$ffa),
               color="gray80") +
  geom_segment(data=filter(t2_allW, vRoi == "v2"), inherit.aes = FALSE,
               aes(x=1.80, y=filter(t2_allW, vRoi == "v2")$ppa,
                   xend=2.20, yend=filter(t2_allW, vRoi == "v2")$ffa),
               color="gray80") +
  geom_segment(data=filter(t2_allW, vRoi == "v3"), inherit.aes = FALSE,
               aes(x=2.80, y=filter(t2_allW, vRoi == "v3")$ppa,
                   xend=3.20, yend=filter(t2_allW, vRoi == "v3")$ffa),
               color="gray80") +
  geom_segment(data=filter(t2_allW, vRoi == "v4"), inherit.aes = FALSE,
               aes(x=3.80, y=filter(t2_allW, vRoi == "v4")$ppa,
                   xend=4.20, yend=filter(t2_allW, vRoi == "v4")$ffa),
               color="gray80") +
  geom_segment(data=filter(t2_allW, vRoi == "v_all"), inherit.aes = FALSE,
               aes(x=4.80, y=filter(t2_allW, vRoi == "v_all")$ppa,
                   xend=5.20, yend=filter(t2_allW, vRoi == "v_all")$ffa),
               color="gray80") +
  geom_point(data=t2_allL, aes(x=vRoi, y=fc, fill=hRoi), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t2_allG, aes(x = vRoi, y=fc.m, ymin = lower.se, ymax = upper.se),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  scale_x_discrete(labels=c("V1","V3","V3","V4","all VC")) +
  scale_fill_manual(values = c("#feb24c", "#91bfdb"), # c("#feb24c", "#91bfdb"),
                    labels = c("PPA", "FFA")) +
  coord_cartesian(ylim = c(-0.3, 0.7), clip = "on") +
  labs(x = "", y = "Background Connectivity (Zr)") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
#ggsave("bg_plot1.jpg", plot = t2.all.plot2, width=8, height=8, unit='in', dpi=600)
t2.all.plot2
```

<br>

각 시각 영역(V1 ~ V4)과 관심 상위 영역(PPA, FFA)을 요인으로 4 x 2 혼합 요인 분산분석을 수행하였다. 

<br>

```{r, collapse=TRUE}
t2_allL.1 <- t2_allL %>% filter(vRoi!="v_all")
t2.aov1 <- aov_ez(id="subj", dv="fc", data = t2_allL.1, within = c("vRoi", "hRoi"))
# summary(t2.aov1)
nice(t2.aov1, es="pes") %>% kable(digits=3)
```

<br>

모든 효과가 유의하였다.

<br>

```{r, collapse=TRUE}
# post-hoc - difference between hROI, by attention condition & vROI
t2.aov1.m1 <- emmeans(t2.aov1, pairwise ~ hRoi | vRoi, adjust = "tukey") # adjust="bon" , "tukey", "none"
t2.aov1.m1$contrasts %>% kable(digits=3)
# plot(t2.aov1.m1, horizontal = T, comparison=T)

# post-hoc - difference between attention, by hROI condition & vROI
t2.aov1.m2 <- emmeans(t2.aov1, pairwise ~ vRoi | hRoi , adjust = "tukey") # adjust="bon" , "tukey", "none"
t2.aov1.m2$contrasts %>% kable(digits=3)
# plot(t2.aov1.m2, horizontal = T, comparison=T)
```

<br>

사후 검정 결과, 모든 시각 영역에서 PPA 보다 FFA 와 bgFC가 더 강하게 나타났다.

<br>
  
  
## 관심 영역의 Repetition Suppression/Enhancement
  
<br>
  
전체 관심 영역 (FFA/PPA, V1~V4) 에서 Repetition Suppression / Enhancement 효과를 검증하였다. 제시 조건은 Initial과 Repeated로 구분되었다. 이 분석에서는 전처리 과정에서 FWHM 0mm로 Spatial Smoothing이 수행되지 않은 데이터를 사용하였다.

<br>

```{r, collapse=TRUE}

# higher ROIs
t3 <- read.csv("data/rse_summary_hroi_nsm.csv", header = T)
t3_l <- t3
# change class of main factors: double to factor
t3_l$subj = factor(t3_l$subj, levels=c("primeRecon_2", "primeRecon_4", 
                                       "primeRecon_5", "primeRecon_6",
                                       "primeRecon_7", "primeRecon_8", 
                                       "primeRecon_9", "primeRecon_10",
                                       "primeRecon_11", "primeRecon_13",
                                       "primeRecon_14", "primeRecon_15",
                                       "primeRecon_16", "primeRecon_17",
                                       "primeRecon_18", "primeRecon_19",
                                       "primeRecon_20", "primeRecon_21",
                                       "primeRecon_22", "primeRecon_23",
                                       "primeRecon_24"), 
                   labels=c(2,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24))
t3_l<-t3_l %>% filter(subj!=99)

t3_l$rseCon = factor(t3_l$rseCon, levels=c("init","rep")) 
t3_l$Roi = factor(t3_l$hRoi, levels=c("r_ppa","r_ffa"), labels=c("ppa","ffa"))
t3_l <- t3_l %>% select(subj, Roi, rseCon, z)

# lower ROIs
t4 <- read.csv("data/rse_summary_ms_nsm.csv", header = T)
glimpse(t4, width = 70)

t4_l <- gather(t4, vRoi, z, v1:v_all, factor_key=TRUE)
t4_l$subj = factor(t4_l$subj, levels=c("primeRecon_2", "primeRecon_4", 
                                       "primeRecon_5", "primeRecon_6",
                                       "primeRecon_7", "primeRecon_8", 
                                       "primeRecon_9", "primeRecon_10",
                                       "primeRecon_11", "primeRecon_13",
                                       "primeRecon_14", "primeRecon_15",
                                       "primeRecon_16", "primeRecon_17",
                                       "primeRecon_18", "primeRecon_19",
                                       "primeRecon_20", "primeRecon_21",
                                       "primeRecon_22", "primeRecon_23",
                                       "primeRecon_24"), 
                   labels=c(2,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24))
t4_l <- t4_l %>% filter(subj!=99)
t4_l$Roi = factor(t4_l$vRoi) 
t4_l$bgCon = factor(t4_l$bgCon)

t4_l$fcCon =factor(t4_l$fcCon, levels=c("low","high","all"))
t4_l$rseCon =factor(t4_l$rseCon, levels=c("init","rep","rse","n_rs","n_re"))

t4_l <- t4_l %>% select(subj, bgCon, Roi, fcCon, rseCon, z) %>% 
  filter(fcCon=="all", rseCon!="rse", rseCon!="n_rs", rseCon!="n_re")
t4_l <- t4_l %>% select(subj, Roi, rseCon, z)

t34 <- rbind(t3_l, t4_l)
t34$rseCon <- factor(t34$rseCon)

glimpse(t34, width = 70)


```

<br>

각 관심 영역에서 제시 조건에 따른 활성화 값의 요약치는 아래와 같다.

<br>

```{r, collapse=TRUE}
t34_allL.1 <- t34 %>% 
  group_by(subj, Roi, rseCon) %>%
  dplyr::summarise(z=mean(z)) %>%
  ungroup()
# t34_allL.1 %>% kable(digits=2)

# subject-level, wide format
t34_allW.1 <- t34_allL.1 %>% spread(key=rseCon, value = z)

# t34_allW.1 <- t34_allL.1 %>% spread(key=Roi, value = z)
# t34_allW.1 %>% kable(digits=2)

# summary table: grand mean
t34_allG.1 <- t34_allL.1 %>% group_by(Roi, rseCon) %>%
  summarise(z.m = mean(z), z.sd = sd(z)) %>%
  ungroup()
t34_allG.1$z.se <- Rmisc::summarySEwithin(data = t34_allL.1, measurevar = "z", 
                                         idvar = "subj", withinvars = c("Roi", "rseCon"))$se
t34_allG.1$z.ci <- Rmisc::summarySEwithin(data = t34_allL.1, measurevar = "z", 
                                         idvar = "subj", withinvars = c("Roi", "rseCon"))$ci
t34_allG.1 <- t34_allG.1 %>% 
  mutate(lower.ci = z.m-z.ci,
         upper.ci = z.m+z.ci)
t34_allG.1 %>% select(Roi, rseCon, z.m) %>% spread(key=rseCon, value=z.m) %>%  kable(digits=2)

```

<br>

아래 그래프는 각 관심 영역에서 제시 조건에 따른 활성화 값(z)을 나타낸다. 그래프에서 Initial > Repeated 으로 활성화가 나타나는 것을 Repetition Suppression으로 해석한다. 점은 평균, error bar는 95% ci를 나타내었다.

<br>


```{r, fig.width= 14, fig.height=6}
t34.all.plot1 <- ggplot(data=t34_allL.1, aes(x=Roi, y=z, fill=rseCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_segment(data=filter(t34_allW.1, Roi == "ppa"), inherit.aes = FALSE,
             aes(x=0.8, y=filter(t34_allW.1, Roi == "ppa")$init,
                 xend=1.2, yend=filter(t34_allW.1, Roi == "ppa")$rep),
             color="gray80") +
  geom_segment(data=filter(t34_allW.1, Roi == "ffa"), inherit.aes = FALSE,
               aes(x=1.8, y=filter(t34_allW.1, Roi == "ffa")$init,
                   xend=2.2, yend=filter(t34_allW.1, Roi == "ffa")$rep),
               color="gray80") +
  geom_segment(data=filter(t34_allW.1, Roi == "v1"), inherit.aes = FALSE,
               aes(x=2.8, y=filter(t34_allW.1, Roi == "v1")$init,
                   xend=3.2, yend=filter(t34_allW.1, Roi == "v1")$rep),
             color="gray80") +
  geom_segment(data=filter(t34_allW.1, Roi == "v2"), inherit.aes = FALSE,
               aes(x=3.8, y=filter(t34_allW.1, Roi == "v2")$init,
                   xend=4.2, yend=filter(t34_allW.1, Roi == "v2")$rep),
               color="gray80") +
  geom_segment(data=filter(t34_allW.1, Roi == "v3"), inherit.aes = FALSE,
               aes(x=4.8, y=filter(t34_allW.1, Roi == "v3")$init,
                   xend=5.2, yend=filter(t34_allW.1, Roi == "v3")$rep),
               color="gray80") +
  geom_segment(data=filter(t34_allW.1, Roi == "v4"), inherit.aes = FALSE,
               aes(x=5.8, y=filter(t34_allW.1, Roi == "v4")$init,
                   xend=6.2, yend=filter(t34_allW.1, Roi == "v4")$rep),
               color="gray80") +
  geom_segment(data=filter(t34_allW.1, Roi == "v_all"), inherit.aes = FALSE,
               aes(x=6.8, y=filter(t34_allW.1, Roi == "v_all")$init,
                   xend=7.2, yend=filter(t34_allW.1, Roi == "v_all")$rep),
               color="gray80") +
  geom_point(data=t34_allL.1, aes(x=Roi, y=z, fill=rseCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t34_allG.1, aes(x = Roi, y=z.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  scale_x_discrete(labels=c("PPA","FFA","V1","V2","V3","V4","All VC")) +
  scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"),  # , "#235796"
                    labels = c("Initial", "Repeated")) +
  coord_cartesian(ylim = c(-1, 5), clip = "on") +
  labs(x = "", y = "Activation (z)") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")

#ggsave("rse_main1_plot.jpg", plot = t34.all.plot1, width=14, height=6, unit='in', dpi=600)
t34.all.plot1

```

<br>

각 관심 영역(ffa, ppa, v1, v2, v3, v4, all Vc)에서 자극 제시 조건(Initial vs. Repeated)을 요인으로 6 x 2 혼합 요인 분산분석을 수행하였다. 분석 결과에서 각 관심 영역 간 차이는 관심 효과가 아님에 유의할 필요가 있다.

<br>

```{r, collapse=TRUE}
t34.aov1 <- aov_ez(id="subj", dv="z", data = t34_allL.1, within = c("Roi", "rseCon"))
#summary(t4.aov1)
nice(t34.aov1, es="pes") %>% kable(digits=3)
```

<br>

각 관심 영역에서 자극 제시 조건에 따른 차이를 사후 검정하였다.

<br>

```{r, collapse=TRUE}
# post-hoc - difference between rgCon, by vROI
t34.aov1.m1 <- emmeans(t34.aov1, pairwise ~ rseCon | Roi, adjust = "tukey") # adjust="bon" , "tukey", "none"
t34.aov1.m1$contrasts %>% kable(digits=3)
#plot(t4.aov1.m1, horizontal = T, comparison=T)

```

<br>

사후 검정 결과, PPA를 제외하고 모든 영역에서 Repetition Suppression 효과(Initial > Repeated)가 나타났다.

<br>
  
## bgFC 강도에 따른 Repetition Suppression (Median Split)
  
<br>
  
관심 시각 영역 (V1~V4) 에서 Repetition Suppression Effect가 FFA-VC Voxel-wise Background Connectivity(bgFC)의 강도에 따라 조절되는지 검증하였다. 자극 제시 조건은 Initial vs. Repeated, FFA-VC bgFC 강도는 Median Split을 통해 Low, High로 구분되었다. 이 분석에서는 Voxel별 bgFC 값이 주요한 변인이므로 전처리 과정에서 Spatial Smoothing이 수행되지 않은 데이터를 사용하였다.

<br>

```{r, collapse=TRUE}
t4 <- read.csv("data/rse_summary_ms_nsm.csv", header = T)

t4_l <- gather(t4, vRoi, z, v1:v_all, factor_key=TRUE)
# change class of main factors: double to factor
t4_l$subj = factor(t4_l$subj, levels=c("primeRecon_2", "primeRecon_4", 
                                       "primeRecon_5", "primeRecon_6",
                                       "primeRecon_7", "primeRecon_8", 
                                       "primeRecon_9", "primeRecon_10",
                                       "primeRecon_11", "primeRecon_13",
                                       "primeRecon_14", "primeRecon_15",
                                       "primeRecon_16", "primeRecon_17",
                                       "primeRecon_18", "primeRecon_19",
                                       "primeRecon_20", "primeRecon_21",
                                       "primeRecon_22", "primeRecon_23",
                                       "primeRecon_24"), 
                   labels=c(2,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24))
t4_l <- t4_l %>% filter(subj!=99)

t4_l$vRoi = factor(t4_l$vRoi) 
t4_l$bgCon = factor(t4_l$bgCon)
t4_l$fcCon =factor(t4_l$fcCon, levels=c("low","high","all"))
t4_l$rseCon =factor(t4_l$rseCon, levels=c("init","rep","rse","n_rs","n_re"))
t4_l <- t4_l %>% select(subj, bgCon, vRoi, fcCon, rseCon, z)

glimpse(t4_l, width = 70)

```

<br>

각 관심 영역에서 자극 제시 조건과 bgFC 강도에 따른 활성화 값의 요약치는 아래와 같다. 

<br>

```{r, collapse=TRUE}
t4_l_1 <- t4_l %>% filter(fcCon!="all", rseCon!="rse", rseCon!="n_rs", rseCon!="n_re")
t4_allL.5 <- t4_l_1 %>% group_by(subj, bgCon, vRoi, fcCon, rseCon) %>%
  dplyr::summarise(z=mean(z)) %>%
  ungroup()
# t4_allL.5 %>% kable(digits=2)

# subject-level, wide format
t4_allW.5 <- t4_allL.5 %>% spread(key=rseCon, value = z)
# t4_allW.5 %>% kable(digits=2)

# summary table: grand mean
t4_allG.5 <- t4_allL.5 %>% group_by(fcCon, vRoi,  rseCon) %>%
  summarise(z.m = mean(z), z.sd = sd(z)) %>%
  ungroup()
t4_allG.5$z.se <- Rmisc::summarySEwithin(data = t4_allL.5, measurevar = "z", 
                                         idvar = "subj", withinvars = c("fcCon", "vRoi", "rseCon"))$se
t4_allG.5$z.ci <- Rmisc::summarySEwithin(data = t4_allL.5, measurevar = "z", 
                                         idvar = "subj", withinvars = c("fcCon", "vRoi", "rseCon"))$ci
t4_allG.5 <- t4_allG.5 %>% 
  mutate(lower.ci = z.m-z.ci,
         upper.ci = z.m+z.ci)
# for between-subject design. check help(summarySE)
# t4_allG.5 %>% kable(digits=2)
# t4_allG.5 %>% select(fcCon, vRoi, rseCon, z.m) %>% spread(key=rseCon, value=z.m) %>% kable(digits=2)
t4_allG.5 %>% select(vRoi, rseCon, fcCon, z.m) %>% spread(key=rseCon, value=z.m) %>% kable(digits=2)
```

<br>

아래 그래프 중 A는 각 관심 영역에서 자극 제시 조건과 bgFC 강도에 따른 활성화 값(z), B는 각 관심 영역에서 bgFC 강도와 자극 제시 조건에 따른 활성화 값(z)을 나타낸다. A에서 Initial > Repeated로 활성화가 나타나는 것을 Repetition Suppression으로 해석한다. B는 bgFC 강도에 따른 전반적인 활성화 차이를 나타낸다. 점은 평균, error bar는 95% ci를 나타내었다.

<br>

```{r, fig.width= 12, fig.height=14}
t4.all.plot5 <- ggplot(data=t4_allL.5, aes(x=vRoi, y=z, fill=rseCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=0, linetype='dashed', color='gray80', alpha =1, size=1) +
  geom_point(data=t4_allL.5, aes(x=vRoi, y=z, fill=rseCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t4_allG.5, aes(x = vRoi, y=z.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~fcCon, scales="free_x", space = "free",
               labeller = labeller(fcCon = c("low"="Low bgFC voxels","high"="High bgFC voxels"))) +
  scale_x_discrete(labels=c("V1","V2","V3","V4","all VC")) +
  scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"),  # , "#235796"
                    labels = c("Initial", "Repeated")) +
  coord_cartesian(ylim = c(-2, 10), clip = "on") +
  labs(x = " ", y = "Activation (z)") +
  # ggtitle("ppa-v connectivity") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.5, 1, 0.5, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
# t4.all.plot5
#ggsave("rse_main2_1_ms_plot.jpg", plot = t4.all.plot5, width=10, height=6, unit='in', dpi=600)


t4.all.plot5.1 <- ggplot(data=t4_allL.5, aes(x=rseCon, y=z, fill=fcCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=0, linetype='dashed', color='gray80', alpha =1, size=1) +
  geom_point(data=t4_allL.5, aes(x=rseCon, y=z, fill=fcCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t4_allG.5, aes(x = rseCon, y=z.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~vRoi, scales="free_x", space = "free", 
             labeller = labeller(vRoi = c("v1" = "V1","v2" = "V2","v3" = "V3","v4" = "V4","v_all" = "all VC"))) +
  scale_x_discrete(labels=c("Initial","Repeated")) +
  scale_fill_manual(values = c("#B1D4E0", "#145DA0"),  # , "#235796" "#B1D4E0", "#2E8BC0","#0C2D48","#145DA0"
                    labels = c("low bgFC voxels", "high bgFC voxels")) +
  coord_cartesian(ylim = c(-2, 10), clip = "on") +
  labs(x = " ", y = "Activation (z)") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        # axis.text.x = element_text(face = "plain", vjust=0.2, hjust= 0.5, angle = -35, size = 15, color = "black"), 
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain",size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.5, 1, 0.5, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
# t4.all.plot5.1
#ggsave("rse_main2_2_ms_plot.jpg", plot = t4.all.plot5.1, width=10, height=6, unit='in', dpi=600)

ggarrange(t4.all.plot5, t4.all.plot5.1, nrow = 2,
          labels=c("A", "B"))

```

<br>

각 관심 시각 영역(v1, v2, v3, v4)에서 자극 제시 조건(Initial vs. Repeated), bgFC 강도(Low vs. High)를 요인으로 4 x 2 x 2 혼합 요인 분산분석을 수행하였다. 분석 결과에서 각 관심 영역 간 차이는 관심 효과가 아님에 유의할 필요가 있다.

<br>

```{r, collapse=TRUE}
t4.aov5 <- aov_ez(id="subj", dv="z", data=t4_allL.5, within = c("vRoi","fcCon","rseCon"))
#summary(t4.aov5)
nice(t4.aov5, es="pes") %>% kable(digits=3)

```

<br>

관심 영역, 자극 제시 조건, bgFC 강도의 주효과, 관심 영역과 bgFC 강도 간의 상호작용,  bgFC 강도와 자극 제시 조건 간의 상호작용이 유의하였다. 각 관심 영역에서 자극 제시 조건과 bgFC 강도에 따른 차이를 사후 검정하였다.

<br>

```{r, collapse=TRUE}
# post-hoc - difference between rgCon, by bgFC, vROI
t4.aov5.m1 <- emmeans(t4.aov5, pairwise ~ rseCon | fcCon + vRoi, adjust = "tukey") # adjust="bon" , "tukey", "none"
t4.aov5.m1$contrasts %>% kable(digits=3)
# plot(t4.aov5.m1, horizontal = T, comparison=T)
```

<br>

모든 시각 영역에서 high bgFC 조건의 repetition suppression이 유의하게 나타났다.

<br>

```{r, collapse=TRUE}
t4.aov5.m2 <- emmeans(t4.aov5, pairwise ~ fcCon | rseCon + vRoi, adjust = "tukey") # adjust="bon" , "tukey", "none"
t4.aov5.m2$contrasts %>% kable(digits=3)
# plot(t4.aov5.m1, horizontal = T, comparison=T)
```
  
<br>

전반적으로, low bgFC 보다 high bgFC의 활성화 값이 높게 나타났다.

<br>
  

## bgFC 강도에 따른 RSE effect (Median Split)
  
<br>

본 연구의 주요 가설은 Repetition Suppression/Enhancement Effect (RSE effect)의 강도가 bgFC 강도에 따라 조절된다는 것이다. 여기서 RSE effect의 강도는 Initial - Repeated의 Difference Score로 정의하였다. RS가 양수이면 Repetition Suppression, 음수이면 Repetition Enhancement를 나타낸다.

<br>

관심 시각 영역과 bgFC 강도에 따른 RS effect의 강도의 요약치는 아래와 같다.
  
<br>
  
```{r, collapse=TRUE}

t4_l_2 <- t4_l %>% filter(rseCon!="n_rs", rseCon!="n_re", rseCon!="init", 
                          rseCon!="rep", fcCon!="all")
t4_W <- t4_l_2 %>% spread(key=fcCon, value=z)
# t4_W %>% kable(digits=2)

t4_l.dif <- t4_l_2
# t4_l.dif %>% kable(digits=2)

# summary table: grand mean
t4_difG <- t4_l.dif %>% group_by(bgCon, vRoi, fcCon) %>%
  summarise(z.m = mean(z), z.sd = sd(z)) %>%
  ungroup()
t4_difG$z.se <- Rmisc::summarySEwithin(data = t4_l.dif, measurevar = "z", 
                                       idvar = "subj", withinvars = c("bgCon","fcCon", "vRoi"))$se
t4_difG$z.ci <- Rmisc::summarySEwithin(data = t4_l.dif, measurevar = "z", 
                                       idvar = "subj", withinvars = c("bgCon","fcCon", "vRoi"))$ci
t4_difG <- t4_difG %>% 
  mutate(lower.ci = z.m-z.ci,
         upper.ci = z.m+z.ci)
t4_difG %>% select(vRoi, fcCon, z.m) %>% spread(fcCon, z.m) %>%  kable(digits=2)
```

<br>

아래 그래프에는 RSE effect를 관심 시각 영역과 bgFC 강도에 따라 나타내었다. 점은 평균, error bar는 95% CI를 나타낸다.

<br>

```{r, fig.width= 11, fig.height=6}
t4_l.dif.4.1 <- t4_l.dif
t4_w.dif.4.1 <- t4_l.dif.4.1 %>% spread(key=fcCon, value=z)
# t4_w.dif.4.1 %>% kable(digits=2)
t4_difG.4.1 <- t4_difG
# t4_difG.4.1 %>% kable(digits=2)
t4.diff.plot4.1 <- ggplot(data=t4_l.dif.4.1, aes(x=vRoi, y=z, fill=fcCon)) +
  geom_hline(yintercept=0, linetype='dashed', color='gray80', alpha =1, size=1) +
  stat_summary(fun = mean, geom = "bar", position="dodge", 
               na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_point(data=t4_l.dif.4.1, aes(x=vRoi, y=z, fill=fcCon), 
             position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_segment(data=filter(t4_w.dif.4.1, vRoi == "v1"), inherit.aes = FALSE,
               aes(x=0.8, y=filter(t4_w.dif.4.1, vRoi == "v1")$low,
                   xend=1.2, yend=filter(t4_w.dif.4.1, vRoi == "v1")$high),
               color="gray80") +
  geom_segment(data=filter(t4_w.dif.4.1, vRoi == "v2"), inherit.aes = FALSE,
               aes(x=1.8, y=filter(t4_w.dif.4.1, vRoi == "v2")$low,
                   xend=2.2, yend=filter(t4_w.dif.4.1, vRoi == "v2")$high),
               color="gray80") +
  geom_segment(data=filter(t4_w.dif.4.1, vRoi == "v3"), inherit.aes = FALSE,
               aes(x=2.8, y=filter(t4_w.dif.4.1, vRoi == "v3")$low,
                   xend=3.2, yend=filter(t4_w.dif.4.1, vRoi == "v3")$high),
               color="gray80") +
  geom_segment(data=filter(t4_w.dif.4.1, vRoi == "v4"), inherit.aes = FALSE,
               aes(x=3.8, y=filter(t4_w.dif.4.1, vRoi == "v4")$low,
                   xend=4.2, yend=filter(t4_w.dif.4.1, vRoi == "v4")$high),
               color="gray80") +
  geom_segment(data=filter(t4_w.dif.4.1, vRoi == "v_all"), inherit.aes = FALSE,
               aes(x=4.8, y=filter(t4_w.dif.4.1, vRoi == "v_all")$low,
                   xend=5.2, yend=filter(t4_w.dif.4.1, vRoi == "v_all")$high),
               color="gray80") +
  geom_pointrange(data=t4_difG.4.1, aes(x = vRoi, y=z.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  scale_x_discrete(labels=c("V1","V2","V3","V4", "All VC")) +
  scale_fill_manual(values = c("#AFDBF5", "#051422"),  # , "#235796"
                    # "#B1D4E0", "#2E8BC0","#0C2D48","#145DA0"
                    # "#AFDBF5", "#195779", "#5BAED9", "#051422"),  # , "#235796"
                    labels = c("Low bgFC", "High bgFC")) +
  coord_cartesian(ylim = c(-1, 2), clip = "on") +
  labs(x = " ", y = "RSE Effect (z)\n[Initial - Repeated]") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.text.x = element_text(face = "plain", vjust = -2, hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
#ggsave("rse_main3_ms_plot.jpg", plot = t4.diff.plot4.1, width=10, height=6, unit='in', dpi=600)
t4.diff.plot4.1

```

<br>

각 관심 시각 영역(v1, v2, v3, v4, all VC)에서 bgFC 강도(Low vs. High)를 요인으로 5 x 2 혼합 요인 분산분석을 수행하였다. 분석 결과에서 각 관심 영역 간 차이는 관심 효과가 아님에 유의할 필요가 있다.

<br>


```{r, collapse=TRUE}
t4_l.dif.4.1 <-  t4_l.dif
t4.2.aov4.1 <- aov_ez(id="subj", dv="z", data = t4_l.dif.4.1, within = c("vRoi", "fcCon"))
# summary(t4.2.aov4.1)
# anova(t4.2.aov4.1, es="pes")
nice(t4.2.aov4.1, es="pes") %>% kable(digits=2)
```

<br>

bgFC 강도의 주효과가 유의하였다.
각 관심 영역에서 bgFC 강도에 따른 Difference Score의 차이를 사후 검정하였다.

<br>

```{r, collapse=TRUE}
# post-hoc - same-diff RG - difference between fcCon, by vROI
t4.2.aov4.1.m1 <- emmeans(t4.2.aov4.1, pairwise ~ fcCon | vRoi, adjust = "tukey") # adjust="bon" , "tukey", "none"
t4.2.aov4.1.m1$contrasts %>% kable(digits=3)
# plot(t4.2.aov4.1.m1, horizontal = T, comparison=T)

```

<br>

모든 영역에서 high bgFC의 RSE effect가 low bgFC 보다 높게 나타났다. 또한 이 값들은 양수로 나타났다. 이는 모든 영역에서 Repetition Suppression이 나타난다는 것을 보여준다.

<br>

## bgFC 강도에 따른 Repetition Suppression (4 Quantile Split)
  
<br>
  
관심 시각 영역 (V1~V4) 에서 Repetition Suppression Effect가 FFA-VC Voxel-wise Background Connectivity(bgFC)의 강도에 따라 조절되는지 검증하였다. 자극 제시 조건은 Initial vs. Repeated, PPA-VC bgFC 강도는 4 Quantile Split을 통해 Low, Low-med, High-med, High로 구분되었다. 이 분석에서는 Voxel별 bgFC 값이 주요한 변인이므로 전처리 과정에서 Spatial Smoothing이 수행되지 않은 데이터를 사용하였다.

<br>

```{r, collapse=TRUE}
t6 <- read.csv("data/rse_summary_qs_nsm.csv", header = T)
t6_l <- gather(t6, vRoi, z, v1:v_all, factor_key=TRUE)

# change class of main factors: double to factor
t6_l$subj = factor(t6_l$subj, levels=c("primeRecon_2", "primeRecon_4", 
                                       "primeRecon_5", "primeRecon_6",
                                       "primeRecon_7", "primeRecon_8", 
                                       "primeRecon_9", "primeRecon_10",
                                       "primeRecon_11", "primeRecon_13",
                                       "primeRecon_14", "primeRecon_15",
                                       "primeRecon_16", "primeRecon_17",
                                       "primeRecon_18", "primeRecon_19",
                                       "primeRecon_20", "primeRecon_21",
                                       "primeRecon_22", "primeRecon_23",
                                       "primeRecon_24"), 
                   labels=c(2,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24))
t6_l <- t6_l %>% filter(subj!=99)

t6_l$vRoi = factor(t6_l$vRoi) 
t6_l$bgCon = factor(t6_l$bgCon)
t6_l$fcCon =factor(t6_l$fcCon, levels=c("low","low_med","high_med", "high","all"))
t6_l$rseCon =factor(t6_l$rseCon, levels=c("init","rep","rse","n_rs","n_re"))
t6_l <- t6_l %>% select(subj, bgCon, vRoi, fcCon, rseCon, z)

glimpse(t6_l, width = 70)
```

<br>

각 관심 영역에서 자극 제시 조건과 bgFC 강도에 따른 활성화 값의 요약치는 아래와 같다.

<br>

```{r, collapse=TRUE}
t6_l_1 <- t6_l %>% filter(fcCon!="all", rseCon!="rse", rseCon!="n_rs", rseCon!="n_re")
t6_allL.5 <- t6_l_1 %>%  group_by(subj, bgCon, vRoi, fcCon, rseCon) %>%
  dplyr::summarise(z=mean(z)) %>%
  ungroup()
# t6_allL.5 %>% kable(digits=2)

# subject-level, wide format
t6_allW.5 <- t6_allL.5 %>% spread(key=rseCon, value = z)
# t6_allW.5 %>% kable(digits=2)

# summary table: grand mean
t6_allG.5 <- t6_allL.5 %>% group_by(fcCon, vRoi,  rseCon) %>%
  summarise(z.m = mean(z), z.sd = sd(z)) %>%
  ungroup()
t6_allG.5$z.se <- Rmisc::summarySEwithin(data = t6_allL.5, measurevar = "z", 
                                         idvar = "subj", withinvars = c("fcCon", "vRoi", "rseCon"))$se
t6_allG.5$z.ci <- Rmisc::summarySEwithin(data = t6_allL.5, measurevar = "z", 
                                         idvar = "subj", withinvars = c("fcCon", "vRoi", "rseCon"))$ci
t6_allG.5 <- t6_allG.5 %>% 
  mutate(lower.ci = z.m-z.ci,
         upper.ci = z.m+z.ci)
t6_allG.5 %>% select(vRoi, fcCon, rseCon, z.m) %>% spread(key=rseCon, value=z.m) %>% kable(digits=2)
```

<br>

아래 그래프 중 A는 각 관심 영역에서 자극 제시 조건과 bgFC 강도에 따른 활성화 값(z), B는 각 관심 영역에서 bgFC 강도와 자극 제시 조건에 따른 활성화 값(z)을 나타낸다. 점은 평균, error bar는 95% ci를 나타내었다.

<br>

```{r, fig.width= 12, fig.height= 14}
t6.all.plot5 <- ggplot(data=t6_allL.5, aes(x=vRoi, y=z, fill=rseCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=0, linetype='dashed', color='gray80', alpha =1, size=1) +
  geom_point(data=t6_allL.5, aes(x=vRoi, y=z, fill=rseCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t6_allG.5, aes(x = vRoi, y=z.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~fcCon, scales="free_x", space = "free") +
  scale_x_discrete(labels=c("V1","V2","V3","V4","all VC")) +
  scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"),  # , "#235796"
                    labels = c("Initial", "Repeated")) +
  coord_cartesian(ylim = c(-2, 10), clip = "on") +
  labs(x = " ", y = "Activation (z)") +
  # ggtitle("ppa-v connectivity") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.5, 1, 0.5, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
# t6.all.plot5
#ggsave("rse_main2_1_qs_plot.jpg", plot = t6.all.plot5, width=10, height=6, unit='in', dpi=600)


t6.all.plot5.1 <- ggplot(data=t6_allL.5, aes(x=rseCon, y=z, fill=fcCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=0, linetype='dashed', color='gray80', alpha =1, size=1) +
  geom_point(data=t6_allL.5, aes(x=rseCon, y=z, fill=fcCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t6_allG.5, aes(x = rseCon, y=z.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~vRoi, scales="free_x", space = "free", 
             labeller = labeller(vRoi = c("v1" = "V1","v2" = "V2","v3" = "V3","v4" = "V4","v_all" = "all VC"))) +
  scale_x_discrete(labels=c("Initial","Repeated")) +
  scale_fill_manual(values = c("#B1D4E0", "#2E8BC0","#0C2D48","#145DA0"),  # , "#235796"
                    labels = c("Lowest", "Low", "High", "Hgihest"))+
  coord_cartesian(ylim = c(-2, 10), clip = "on") +
  labs(x = " ", y = "Activation (z)") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        # axis.text.x = element_text(face = "plain", vjust=0.2, hjust= 0.5, angle = -35, size = 15, color = "black"), 
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain",size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.5, 1, 0.5, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
# t6.all.plot5.1
#ggsave("rse_main2_2_qs_plot.jpg", plot = t6.all.plot5.1, width=10, height=6, unit='in', dpi=600)

ggarrange(t6.all.plot5, t6.all.plot5.1, nrow = 2,
          labels=c("A", "B"))

```

<br>

각 관심 시각 영역(v1, v2, v3, v4)에서 자극 제시 조건(Initial vs. Repeated), bgFC 강도(Low vs. Low-Med vs. High-Med vs. High)를 요인으로 4 x 2 x 4 혼합 요인 분산분석을 수행하였다. 분석 결과에서 각 관심 영역 간 차이는 관심 효과가 아님에 유의할 필요가 있다.

<br>

```{r, collapse=TRUE}
t6.aov5 <- aov_ez(id="subj", dv="z", data=t6_allL.5, within = c("vRoi","fcCon","rseCon"))
# summary(t6.aov5)
nice(t6.aov5, es="pes") %>% kable(digits=2)
```

<br>

자극 제시 조건, bgFC 강도의 주효과, 관심 영역과 bgFC 강도 간의 상호작용, 관심 영역, 자극 제시 조건, bgFC 강도의 삼원 상호 작용이 유의하였다. 각 관심 영역에서 자극 제시 조건과 bgFC 강도에 따른 차이를 사후 검정하였다.

<br>

```{r, collapse=TRUE}
t6.aov5.m1 <- emmeans(t6.aov5, pairwise ~ rseCon | fcCon + vRoi, adjust = "tukey") # adjust="bon" , "tukey", "none"
t6.aov5.m1$contrasts %>% kable(digits=3)
# plot(t6.aov5.m1, horizontal = T, comparison=T)
```

<br>

high bgFC 조건에서 Repetition Suppression이 유의하게 나타났다.

<br>

```{r, collapse=TRUE}
t6.aov5.m2 <- emmeans(t6.aov5, pairwise ~ fcCon | rseCon + vRoi, adjust = "tukey") # adjust="bon" , "tukey", "none"
t6.aov5.m2$contrasts %>% kable(digits=3)
# plot(t6.aov5.m2, horizontal = T, comparison=T)
```
  
<br>

전반적으로, low bgFC 에서 high bgFC로 갈수록 활성화 값이 높게 나타났다.

<br>
  

## bgFC 강도에 따른 RSE effect (4 Quantile Split)
  
<br>

Median Split에서와 동일한 분석을 수행하였다. 

<br>

관심 시각 영역과 bgFC 강도에 따른 RSE effect 강도의 요약치는 아래와 같다.
  
<br>
  
```{r, collapse=TRUE}
t6_l_2 <- t6_l %>% filter(rseCon!="n_rs", rseCon!="n_re", rseCon!="init", 
                          rseCon!="rep", fcCon!="all")

t6_W <- t6_l_2 %>% spread(key=fcCon, value=z)
# t6_W %>% kable(digits=2)
t6_l.dif <- t6_l_2
# t6_l.dif %>% kable(digits=2)

# summary table: grand mean
t6_difG <- t6_l.dif %>% group_by(bgCon, vRoi, fcCon) %>%
  summarise(z.m = mean(z), z.sd = sd(z)) %>%
  ungroup()
t6_difG$z.se <- Rmisc::summarySEwithin(data = t6_l.dif, measurevar = "z", 
                                       idvar = "subj", withinvars = c("bgCon","fcCon", "vRoi"))$se
t6_difG$z.ci <- Rmisc::summarySEwithin(data = t6_l.dif, measurevar = "z", 
                                       idvar = "subj", withinvars = c("bgCon","fcCon", "vRoi"))$ci
t6_difG <- t6_difG %>% 
  mutate(lower.ci = z.m-z.ci,
         upper.ci = z.m+z.ci)
t6_difG %>% select(vRoi, fcCon, z.m) %>% spread(fcCon, value=z.m)%>% kable(digits=2)
```

<br>

아래 그래프에는 RSE effect를 관심 시각 영역과 bgFC 강도에 따라 나타내었다. 점은 평균, error bar는 95% CI를 나타낸다.

<br>

```{r, fig.width= 11, fig.height=6}
t5_l.dif.4.1 <- t6_l.dif 
t5_w.dif.4.1 <- t5_l.dif.4.1 %>% spread(key=fcCon, value=z)
t5_difG.4.1 <- t6_difG
# t5_difG.4.1 %>% kable(digits=2)
t5.diff.plot5.1 <- ggplot(data=t5_l.dif.4.1, aes(x=vRoi, y=z, fill=fcCon)) +
  geom_hline(yintercept=0, linetype='dashed', color='gray80', alpha =1, size=1) +
  stat_summary(fun = mean, geom = "bar", position="dodge", 
               na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_point(data=t5_l.dif.4.1, aes(x=vRoi, y=z, fill=fcCon), 
             position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v1"), inherit.aes = FALSE,
               aes(x=0.7, y=filter(t5_w.dif.4.1, vRoi == "v1")$low,
                   xend=0.9, yend=filter(t5_w.dif.4.1, vRoi == "v1")$low_med),
               color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v1"), inherit.aes = FALSE,
               aes(x=0.9, y=filter(t5_w.dif.4.1, vRoi == "v1")$low_med,
                   xend=1.1, yend=filter(t5_w.dif.4.1, vRoi == "v1")$high_med),
               color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v1"), inherit.aes = FALSE,
               aes(x=1.1, y=filter(t5_w.dif.4.1, vRoi == "v1")$high_med,
                   xend=1.3, yend=filter(t5_w.dif.4.1, vRoi == "v1")$high),
               color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v2"), inherit.aes = FALSE,
               aes(x=1.7, y=filter(t5_w.dif.4.1, vRoi == "v2")$low,
                   xend=1.9, yend=filter(t5_w.dif.4.1, vRoi == "v2")$low_med),
               color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v2"), inherit.aes = FALSE,
               aes(x=1.9, y=filter(t5_w.dif.4.1, vRoi == "v2")$low_med,
                   xend=2.1, yend=filter(t5_w.dif.4.1, vRoi == "v2")$high_med),
               color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v2"), inherit.aes = FALSE,
               aes(x=2.1, y=filter(t5_w.dif.4.1, vRoi == "v2")$high_med,
                   xend=2.3, yend=filter(t5_w.dif.4.1, vRoi == "v2")$high),
               color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v3"), inherit.aes = FALSE,
               aes(x=2.7, y=filter(t5_w.dif.4.1, vRoi == "v3")$low,
                   xend=2.9, yend=filter(t5_w.dif.4.1, vRoi == "v3")$low_med),
               color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v3"), inherit.aes = FALSE,
               aes(x=2.9, y=filter(t5_w.dif.4.1, vRoi == "v3")$low_med,
                   xend=3.1, yend=filter(t5_w.dif.4.1, vRoi == "v3")$high_med),
               color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v3"), inherit.aes = FALSE,
               aes(x=3.1, y=filter(t5_w.dif.4.1, vRoi == "v3")$high_med,
                   xend=3.3, yend=filter(t5_w.dif.4.1, vRoi == "v3")$high),
               color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v4"), inherit.aes = FALSE,
               aes(x=3.7, y=filter(t5_w.dif.4.1, vRoi == "v4")$low,
                   xend=3.9, yend=filter(t5_w.dif.4.1, vRoi == "v4")$low_med),
               color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v4"), inherit.aes = FALSE,
               aes(x=3.9, y=filter(t5_w.dif.4.1, vRoi == "v4")$low_med,
                   xend=4.1, yend=filter(t5_w.dif.4.1, vRoi == "v4")$high_med),
               color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v4"), inherit.aes = FALSE,
               aes(x=4.1, y=filter(t5_w.dif.4.1, vRoi == "v4")$high_med,
                   xend=4.3, yend=filter(t5_w.dif.4.1, vRoi == "v4")$high),
               color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v_all"), inherit.aes = FALSE,
             aes(x=4.7, y=filter(t5_w.dif.4.1, vRoi == "v_all")$low,
                 xend=4.9, yend=filter(t5_w.dif.4.1, vRoi == "v_all")$low_med),
             color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v_all"), inherit.aes = FALSE,
               aes(x=4.9, y=filter(t5_w.dif.4.1, vRoi == "v_all")$low_med,
                   xend=5.1, yend=filter(t5_w.dif.4.1, vRoi == "v_all")$high_med),
               color="gray80") +
  geom_segment(data=filter(t5_w.dif.4.1, vRoi == "v_all"), inherit.aes = FALSE,
               aes(x=5.1, y=filter(t5_w.dif.4.1, vRoi == "v_all")$high_med,
                   xend=5.3, yend=filter(t5_w.dif.4.1, vRoi == "v_all")$high),
               color="gray80") +
  geom_pointrange(data=t5_difG.4.1, aes(x = vRoi, y=z.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  scale_x_discrete(labels=c("V1","V2","V3","V4", "All VC")) +
  scale_fill_manual(values = c("#AFDBF5", "#195779", "#5BAED9", "#051422"),  # , "#235796"
                    labels = c("Lowest", "Low",  "High",  "Highest")) +
  coord_cartesian(ylim = c(-1, 2), clip = "on") +
  labs(x = " ", y = "RSE effect (z)\n[Same - Different]") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.text.x = element_text(face = "plain", vjust=-2, hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
        # legend.position=c(0.8, 0.85))
t5.diff.plot5.1
#ggsave("rse_main3_3_ qs_plot.jpg", plot = t5.diff.plot5.1, width=8, height=6, unit='in', dpi=600)
```

<br>

각 관심 시각 영역(v1, v2, v3, v4, all VC)에서 bgFC 강도(Low vs. Low-med vs. High-Med vs. High)를 요인으로 5 x 4 혼합 요인 분산분석을 수행하였다. 분석 결과에서 각 관심 영역 간 차이는 관심 효과가 아님에 유의할 필요가 있다.

<br>


```{r, collapse=TRUE}
t5.2.aov4.1 <- aov_ez(id="subj", dv="z", data = t5_l.dif.4.1, within = c("vRoi", "fcCon"))
# summary(t4.2.aov4.1)
nice(t5.2.aov4.1, es="pes") %>% kable(digits=3)
```

<br>

관심 영역의 주효과가 유의하였다. 관심 영역과 bgFC 강도 간의 상호 작용은 유의하지 않았으나, 높은 트렌드를 보였다.
각 관심 영역에서 bgFC 강도에 따른 Difference Score의 차이를 사후 검정하였다.

<br>

```{r, collapse=TRUE}
t5.2.aov4.1.m1 <- emmeans(t5.2.aov4.1, pairwise ~ fcCon | vRoi, adjust = "tukey") # adjust="bon" , "tukey", "none"
t5.2.aov4.1.m1$contrasts %>% kable(digits=3)
# plot(t4.2.aov4.1.m1, horizontal = T, comparison=T)

```

<br>

v3, v4에서 high bgFC의 Difference Score가 low bgFC 보다 높게 나타났다.

<br>

## 각 복셀별 RSE effect 와 bgFC 간의 상관 관계
  
<br>
  
관심 시각 영역 (V1~V4, all VC) 에서 RSE Effect가 FFA-VC Voxel-wise Background Connectivity(bgFC)의 강도에 따라 조절되는지 검증하기 위해 더 직접적인 상관 분석을 수행하였다. 각 참가자 내의 관심 영역에서 voxel들을 전체 voxel, RS voxel, RE voxel의 세 조건으로 나누었다. 각 조건에서 voxel 별로 Initial - Repeated의 Difference Score를 계산한 후 각 voxel 별 FFA-VC bgFC 값과 상관을 계산하였다. RSE는 initial - Repeated로 계산되었기 때문에, 양수는 Repetition Suppression, 음수 값음 Repetition Enhancement 를 의미한다. 전체 복셀에서 0 보다 유의하게 상관계수가 높다는 것은 bgFC 강도가 높을수록 RSE effect의 강도도 높다는 것을 나타낸다. RS 복셀에서 0보다 유의하게 상관계수가 높다는 것은 bgFC 강도가 클수록 Repetition Suppression 효과가 강하다는 것을 나타낸다. 반대로, RE 복셀에서는 음수를 양수로 변환하였다. 따라서 RE 복셀에서 0보다 높은 상관계수는 bgFC 강도가 클수록 Repetition Enhancement 효과가 강하다는 것을 나타낸다. 

<br>


```{r, collapse=TRUE}
s1 <- read.csv("data/rse_summary_corr_nsm.csv", header = T)

s1_l <- s1
s1_l$subj = factor(s1_l$subj, levels=c("primeRecon_2", "primeRecon_4", 
                                       "primeRecon_5", "primeRecon_6",
                                       "primeRecon_7", "primeRecon_8", 
                                       "primeRecon_9", "primeRecon_10",
                                       "primeRecon_11", "primeRecon_13",
                                       "primeRecon_14", "primeRecon_15",
                                       "primeRecon_16", "primeRecon_17",
                                       "primeRecon_18", "primeRecon_19",
                                       "primeRecon_20", "primeRecon_21",
                                       "primeRecon_22", "primeRecon_23",
                                       "primeRecon_24"), 
                   labels=c(2,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24))
s1_l <- s1_l %>% filter(subj!=99)
s1_l$vRoi = factor(s1_l$vRoi, levels=c("v1","v2","v3","v4","v_all")) 
s1_l$rseCon <- factor(s1_l$rseCon, levels=c("all", "rs", "re"), labels=c("all", "RS", "RE"))
glimpse(s1_l, width = 70)
```

<br>

각 관심 영역에서 voxel 별 difference score와 bgFC의 상관 관계를 Fisher의 Z transform하여 요약하였다.

<br>

```{r, collapse=TRUE}
s1_allL <- s1_l %>% 
  select(subj, vRoi, rseCon, Zr) %>% 
  group_by(subj, vRoi, rseCon) %>%
  dplyr::summarise(Zr=mean(Zr)) %>%
  ungroup()
# s1_allL %>% kable(digits=2)

# subject-level, wide format
s1_allW <- s1_allL %>% select(subj, vRoi, rseCon, Zr) %>% spread(key=vRoi, value = Zr)
#s1_allW %>% kable(digits=2)

# summary table: grand mean
s1_allG <- s1_allL %>% group_by(vRoi, rseCon) %>%
  summarise(Zr.m = mean(Zr), Zr.sd = sd(Zr)) %>%
  ungroup()
s1_allG$Zr.se <- Rmisc::summarySEwithin(data = s1_allL, measurevar = "Zr", 
                                        idvar = "subj", withinvars = c("vRoi","rseCon"))$se
s1_allG$Zr.ci <- Rmisc::summarySEwithin(data = s1_allL, measurevar = "Zr", 
                                        idvar = "subj", withinvars = c("vRoi","rseCon"))$ci
s1_allG <- s1_allG %>% 
  mutate(lower.ci = Zr.m-Zr.ci,
         upper.ci = Zr.m+Zr.ci)
s1_allG %>% select(rseCon, vRoi, Zr.m) %>% spread(vRoi, Zr.m) %>% kable(digits=2)
```

<br>

추가로 개별 참가자의 상관분석에서 획득된 p-value를 나타내었다. p-value는 1 - p-value로 계산되었으므로, 0.95 보다 높은 값은 해당 상관 관계의 p-value가 유의하게 나타났다는 것을 보여준다.

<br>

```{r, collapse=TRUE}
s1_allL1 <- s1_l %>% mutate(pval = 1-pval)

s1_allL1 <- s1_allL1 %>% 
  select(subj, vRoi, rseCon, pval) %>% 
  group_by(subj, vRoi, rseCon) %>%
  dplyr::summarise(pval=mean(pval)) %>%
  ungroup()
# s1_allL1 %>% kable(digits=2)

s1_allW1 <- s1_allL1 %>% select(subj, vRoi, rseCon, pval) %>% spread(key=vRoi, value = pval)
# s1_allW1 %>% kable(digits=2)

s1_allG1 <- s1_allL1 %>% group_by(vRoi, rseCon) %>%
  summarise(pval.m = mean(pval), pval.sd = sd(pval)) %>%
  ungroup()
s1_allG1$pval.se <- Rmisc::summarySEwithin(data = s1_allL1, measurevar = "pval", 
                                         idvar = "subj", withinvars = c("vRoi","rseCon"))$se
s1_allG1$pval.ci <- Rmisc::summarySEwithin(data = s1_allL1, measurevar = "pval", 
                                         idvar = "subj", withinvars = c("vRoi","rseCon"))$ci
s1_allG1 <- s1_allG1 %>% 
  mutate(lower.ci = pval.m-pval.ci,
         upper.ci = pval.m+pval.ci)
s1_allG1 %>% select(rseCon, vRoi, pval.m) %>% spread(vRoi, pval.m) %>% kable(digits=2)
```

<br>

각 관심 영역의 전체 voxel 조건에서 voxel 별 difference score와 bgFC의 Zr과 p-value 들을 그래프로 나타내었다. 이 분석에는 모든 RSE 복셀이 포함되었다. A는 voxel 별 difference score와 bgFC의 Zr, B는  voxel 별 difference score와 bgFC correlation의 p-value를 나타낸다. 점은 평군, error bar는 95% CI를 나타낸다.

<br>

```{r, fig.width= 14, fig.height=6}
s1_allL.1 <- s1_allL %>% filter(rseCon=="all")
s1_allG.1 <- s1_allG %>% filter(rseCon=="all")
s1.all.plot1 <- ggplot(data=s1_allL.1, aes(x=vRoi, y=Zr, fill=vRoi)) +
  geom_hline(yintercept=0, linetype='dashed', color='gray80', alpha =1, size=1) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02, show.legend=F) +
  geom_point(data=s1_allL.1, aes(x=vRoi, y=Zr, fill=vRoi), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=s1_allG.1, aes(x = vRoi, y=Zr.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  scale_x_discrete(labels=c("V1","V2","V3","V4", "All VC")) +
  scale_fill_manual(values = c("#B1D4E0", "#2E8BC0","#0C2D48","#145DA0","#DBDBDB")) +
  coord_cartesian(ylim = c(-0.1, 0.5), clip = "on") +
  labs(x = "", y = "Correlation (Zr)") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
# s1.all.plot1
#ggsave("rg_corr_nsm_plot1.jpg", plot = s1.all.plot1, width=8, height=8, unit='in', dpi=600)

s1_allL1.1 <- s1_allL1 %>% filter(rseCon=="all")
s1_allG1.1 <- s1_allG1 %>% filter(rseCon=="all")
s1.all.plot2 <- ggplot(data=s1_allL1.1, aes(x=vRoi, y=pval, fill=vRoi)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02, show.legend=F) +
  geom_hline(yintercept=0.95, linetype='dashed', color='black', alpha =1, size=1) +
  geom_point(data=s1_allL1.1, aes(x=vRoi, y=pval, fill=vRoi), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=s1_allG1.1, aes(x = vRoi, y=pval.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  scale_x_discrete(labels=c("V1","V2","V3","V4", "All VC")) +
  scale_fill_manual(values = c("#B1D4E0", "#2E8BC0","#0C2D48","#145DA0","#DBDBDB")) +
  coord_cartesian(ylim = c(0.4, 1.1), clip = "on") +
  labs(x = "", y = "1-pvalue of Correlation (RG & bgFC)") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
# s1.all.plot2
#ggsave("rg_corr_nsm_plot2.jpg", plot = s1.all.plot2, width=8, height=8, unit='in', dpi=600)

ggarrange(s1.all.plot1, s1.all.plot2, ncol=2,
          labels=c("A", "B"))
```

<br>

각 관심 영역에서 voxel 별 difference score와 bgFC의 Zr이 0보다 유의하게 큰 지 확인하기 위해 단일 표본 t-검정을 수행하였다.

<br>

```{r, collapse=TRUE}
s1.v1 <- s1_allL.1 %>% filter(vRoi=="v1")
s1.v2 <- s1_allL.1 %>% filter(vRoi=="v2")
s1.v3 <- s1_allL.1 %>% filter(vRoi=="v3")
s1.v4 <- s1_allL.1 %>% filter(vRoi=="v4")
s1.vall <- s1_allL.1 %>% filter(vRoi=="v_all")


s1.ttest.v1 <- t.test(Zr ~ 1, data=s1.v1,
                       alternative = c("two.sided"),
                       conf.level=.95)
s1.ttest.v1

s1.ttest.v2 <- t.test(Zr ~ 1, data=s1.v2,
                      alternative = c("two.sided"),
                      conf.level=.95)
s1.ttest.v2

s1.ttest.v3 <- t.test(Zr ~ 1, data=s1.v3,
                      alternative = c("two.sided"),
                      conf.level=.95)
s1.ttest.v3

s1.ttest.v4 <- t.test(Zr ~ 1, data=s1.v4,
                      alternative = c("two.sided"),
                      conf.level=.95)
s1.ttest.v4

s1.ttest.vall <- t.test(Zr ~ 1, data=s1.vall,
                      alternative = c("two.sided"),
                      conf.level=.95)
s1.ttest.vall

```

<br>

아래의 Results 2 분석에서는 상위 영역인 FFA의 RS voxel과 하위 영역 V3&4의 RE voxel 간의 연결성이 FFA RE - V3&4 RE 간의 연결성보다 높게 나타났다. 이는 Error unit이 상위 영역의 Representation Unit으로 Feedforward signal을 보낸다는 PC의 설명과 맞는 것으로 볼 수 있다. 

<br>

그러나 Results 1의 분석에서 상위 영역과 높은 연결성을 보일수록 VC의 RE 효과가 적다는 것도 확인하였다. 이 두 결과는 얼핏보면 서로 맞지 않는 것으로 보인다. 이는 Results 1의 분석에서 FFA를 RS/RE로 나누어 살펴보지 않았기 때문일 수 있다. 또 다른 가능한 설명은 FFA - VC 연결성이 RS/RE라는 두 유형의 복셀들에 서로 다르게 작용하는데 복셀 수의 차이 때문에 이 효과가 가려진다는 것이다. RS 복셀들에서 RS의 효과가 클수록 연결성이 강하고, RE 복셀들에서 RE의 효과가 클수록 연결성이 강하다고 하더라도, RS 복셀의 수가 RE 복셀들보다 많기 때문에 Results 1에서의 결과가 나타날 가능성이 있다. Results 1의 해당 분석에서 연결성 값이 드라마틱하게 강하지는 않은 이유가 이렇게 혼재된 관계의 voxel들이 함께 분석되어서일 수 있다. 만약 그렇다면, 복셀들을 사전에 RS/RE로 구분하고 상위 영역과의 연결성과의 관계를 살펴보았을 때  RS의 강도 - 연결성 강도 간의 정적 상관과 RE의 강도 - 연결성 강도의 정적 상관이 모두 관찰될 수 있을 것이다. 아래의 분석에서는 Visual Cortex에서 RS/RE를 구분한 후, 각 복셀들에서 RS effect와 RE effect의 강도와 연결성 간의 관계를 살펴보았다.

<br>

동일하게 RS voxel과 RE voxel을 나누어 그래프로 나타내었다. A는 voxel 별 difference score와 bgFC의 Zr, B는 voxel 별 difference score와 bgFC correlation의 p-value를 나타낸다. 점은 평군, error bar는 95% CI를 나타낸다.

<br>

```{r, fig.width= 14, fig.height=6}
s1_allL.2 <- s1_allL %>% filter(rseCon!="all")
s1_allG.2 <- s1_allG %>% filter(rseCon!="all")
s1.all.plot3 <- ggplot(data=s1_allL.2, aes(x=vRoi, y=Zr, fill=rseCon)) +
  geom_hline(yintercept=0, linetype='dashed', color='gray80', alpha =1, size=1) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02, show.legend=T) +
  geom_point(data=s1_allL.2, aes(x=vRoi, y=Zr, fill=rseCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=s1_allG.2, aes(x = vRoi, y=Zr.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  scale_x_discrete(labels=c("V1","V2","V3","V4", "All VC")) +
  scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"),  # , "#235796"
                    labels = c("RSE of RSs", "RSE of REs")) +
  coord_cartesian(ylim = c(-0.6, 0.6), clip = "on") +
  labs(x = "", y = "Correlation (Zr)") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
s1.all.plot3
#ggsave("rg_corr_nsm_plot3.jpg", plot = s1.all.plot1, width=8, height=8, unit='in', dpi=600)

s1_allL1.2 <- s1_allL1 %>% filter(rseCon!="all")
s1_allG1.2 <- s1_allG1 %>% filter(rseCon!="all")
s1.all.plot4 <- ggplot(data=s1_allL1.2, aes(x=vRoi, y=pval, fill=rseCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02, show.legend=T) +
  geom_hline(yintercept=0.95, linetype='dashed', color='black', alpha =1, size=1) +
  geom_point(data=s1_allL1.2, aes(x=vRoi, y=pval, fill=rseCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=s1_allG1.2, aes(x = vRoi, y=pval.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  scale_x_discrete(labels=c("V1","V2","V3","V4", "All VC")) +
  scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"),  # , "#235796"
                    labels = c("RSE of RSs", "RSE of REs")) +
  coord_cartesian(ylim = c(0.4, 1.1), clip = "on") +
  labs(x = "", y = "1-pvalue of Correlation (RG & bgFC)") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
s1.all.plot4
#ggsave("rg_corr_nsm_plot4.jpg", plot = s1.all.plot4, width=8, height=8, unit='in', dpi=600)

# ggarrange(s1.all.plot3, s1.all.plot4, ncol=2,
          # labels=c("A", "B"))
```

<br>

RS/RE 간에서 연결성의 유형은 유의하게 달랐다. RS 복셀에서는 RS의 크기가 클수록 bgFC 강도도 컸다. 그러나 RE 복셀에서는 RE의 크기가 적을수록 bgFC의 강도가 컸다. 해석하자면, RS 효과가 클수록 상위 영역과 강한 연결성을 보이고, RE 효과가 클수록 상위 영역과 약한 연결성을 보인다는 것이다. 이는 앞선 가설과 일치하지 않는다. RE가 Error Unit이라고 본다면, 상위 영역으로의 feedforward 연결이 존재할 수 있다. 특히 상위 영역의 RS 복셀들로의 Feedforward 연결이 나타날 수 있다. 그러나 현재 분석에서 RE 효과 자체와 상위 영역과 연결성은 역상관을 보이는 것 같다. 물론 현재 상위 영역인 FFA의 timecourse는 RS/RE를 구분하지 않은 연결성이다. **아래에는 FFA에서 RS, RE를 구분하여 연결성을 계산하여 추가할 예정이다.**

<br>

```{r, collapse=TRUE}
s1.aov1.1 <- aov_ez(id="subj", dv="Zr", data = s1_allL.2 , within = c("vRoi", "rseCon"))
nice(s1.aov1.1, es="pes") %>% kable(digits=2)
```

<br>

RS/RE 간에서 연결성의 유형은 통계적으로 유의하게 달랐다.

<br>

```{r, collapse=TRUE}
# post-hoc - same-diff RG - difference between fcCon, by vROI
s1.aov1.1.m1 <- emmeans(s1.aov1.1, pairwise ~ rseCon | vRoi, adjust = "tukey") # adjust="bon" , "tukey", "none"
s1.aov1.1.m1$contrasts %>% kable(digits=3)
# plot(t4.2.aov4.1.m1, horizontal = T, comparison=T)

```

<br>

마찬가지로 각 조건에서 연결성의 강도가 0보다 유의하게 큰지 검정하였다.

<br>

먼저 RS voxel들에서의 결과는 다음과 같다.

<br>

```{r, collapse=TRUE}
s1.v1 <- s1_allL.2 %>% filter(rseCon=="RS", vRoi=="v1")
s1.v2 <- s1_allL.2 %>% filter(rseCon=="RS", vRoi=="v2")
s1.v3 <- s1_allL.2 %>% filter(rseCon=="RS", vRoi=="v3")
s1.v4 <- s1_allL.2 %>% filter(rseCon=="RS", vRoi=="v4")
s1.vall <- s1_allL.2 %>% filter(rseCon=="RS", vRoi=="v_all")

s1.ttest.v1 <- t.test(Zr ~ 1, data=s1.v1,
                       alternative = c("two.sided"),
                       conf.level=.95)
s1.ttest.v1

s1.ttest.v2 <- t.test(Zr ~ 1, data=s1.v2,
                      alternative = c("two.sided"),
                      conf.level=.95)
s1.ttest.v2

s1.ttest.v3 <- t.test(Zr ~ 1, data=s1.v3,
                      alternative = c("two.sided"),
                      conf.level=.95)
s1.ttest.v3

s1.ttest.v4 <- t.test(Zr ~ 1, data=s1.v4,
                      alternative = c("two.sided"),
                      conf.level=.95)
s1.ttest.v4

s1.ttest.vall <- t.test(Zr ~ 1, data=s1.vall,
                      alternative = c("two.sided"),
                      conf.level=.95)
s1.ttest.vall

```

<br>

RE voxel들에서의 결과는 다음과 같다.

<br>

```{r, collapse=TRUE}
s1.v1 <- s1_allL.2 %>% filter(rseCon=="RE", vRoi=="v1")
s1.v2 <- s1_allL.2 %>% filter(rseCon=="RE", vRoi=="v2")
s1.v3 <- s1_allL.2 %>% filter(rseCon=="RE", vRoi=="v3")
s1.v4 <- s1_allL.2 %>% filter(rseCon=="RE", vRoi=="v4")
s1.vall <- s1_allL.2 %>% filter(rseCon=="RE", vRoi=="v_all")

s1.ttest.v1 <- t.test(Zr ~ 1, data=s1.v1,
                       alternative = c("two.sided"),
                       conf.level=.95)
s1.ttest.v1

s1.ttest.v2 <- t.test(Zr ~ 1, data=s1.v2,
                      alternative = c("two.sided"),
                      conf.level=.95)
s1.ttest.v2

s1.ttest.v3 <- t.test(Zr ~ 1, data=s1.v3,
                      alternative = c("two.sided"),
                      conf.level=.95)
s1.ttest.v3

s1.ttest.v4 <- t.test(Zr ~ 1, data=s1.v4,
                      alternative = c("two.sided"),
                      conf.level=.95)
s1.ttest.v4

s1.ttest.vall <- t.test(Zr ~ 1, data=s1.vall,
                      alternative = c("two.sided"),
                      conf.level=.95)
s1.ttest.vall

```

<br>

## 관심 영역에서 RS/RE 복셀의 비율

<br>

가설은 상위 영역과 연결성이 강한 복셀일 수록 RSE의 RS 효과가 크게 나타날 수 있다는 것이었다. 만약 그렇다면 RS/RE 복셀의 개수 자체에서도 차이가 나타날 수 있을까? 일반적으로 RS와 RE의 비율은 70 대 30 정도로 나누어져 있는 듯하다. 이것을 연결성 강도에 따라 나누어서 봤을 때, 우리의 가설이 맞다면 연결성이 강할수록, 즉 median split에서 high 조건인 경우에 RS 복셀과 RE 복셀 간 비율 차이가 더 커질 것이다. 

<br>


```{r, collapse=TRUE}
# Higher ROIs
t8 <- read.csv("data/rse_summary_ffa_nsm.csv", header = T)
t8_l <- t8

# change class of main factors: double to factor
t8_l$subj = factor(t8_l$subj, levels=c("primeRecon_2", "primeRecon_4",
                                       "primeRecon_5", "primeRecon_6",
                                       "primeRecon_7", "primeRecon_8",
                                       "primeRecon_9", "primeRecon_10",
                                       "primeRecon_11", "primeRecon_13",
                                       "primeRecon_14", "primeRecon_15",
                                       "primeRecon_16", "primeRecon_17",
                                       "primeRecon_18", "primeRecon_19",
                                       "primeRecon_20", "primeRecon_21",
                                       "primeRecon_22", "primeRecon_23",
                                       "primeRecon_24"),
                   labels=c(2,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24))
t8_l <- t8_l %>% filter(subj!=99)
t8_l$hRoi = factor(t8_l$hRoi) 
t8_l$rsCon =factor(t8_l$rsCon)
t8_l <- t8_l %>% filter(rsCon != "rs_init", rsCon != "re_init",
                        rsCon != "rs_rep", rsCon != "re_rep",
                        rsCon != "rs_rse", rsCon != "re_rse")
t8_l$rsCon =factor(t8_l$rsCon, levels=c("n_rs","n_re"))
t8_l$z <- t8_l$value
t8_l$Roi <- t8_l$hRoi
t8_l$fcCon <- "all"
t8_l <- t8_l %>% select(subj, Roi, fcCon, rsCon, z)
t8_l_3 <- t8_l
t8_l_4 <- t8_l_3 %>% spread(key=rsCon, value=z)
t8_l_4 <- t8_l_4 %>% mutate(rs_v = n_rs/(n_rs+n_re), re_v = n_re/(n_rs+n_re) )
t8_l_4 <- t8_l_4 %>% select(subj, Roi, fcCon, rs_v, re_v)
t8_l_4 <- gather(t8_l_4, rsCon, prop, c("rs_v", "re_v"), factor_key=T)
t8_l_4$rseCon <- t8_l_4$rsCon
t8_l_4 <- t8_l_4 %>% select(subj, Roi, fcCon, rseCon, prop)

# lower ROIs
t4_l_3 <- t4_l %>% filter(rseCon!="init", rseCon!="rep", rseCon!="rse")
t4_l_4 <- t4_l_3 %>% spread(key=rseCon, value=z)
t4_l_4 <- t4_l_4 %>% mutate(rs_v = n_rs/(n_rs+n_re), re_v = n_re/(n_rs+n_re) )
t4_l_4 <- t4_l_4 %>% select(subj, bgCon, vRoi, fcCon, rs_v, re_v)
t4_l_4 <- gather(t4_l_4, rseCon, prop, c("rs_v", "re_v"), factor_key=T)
t4_l_4$Roi <- t4_l_4$vRoi
t4_l_4 <- t4_l_4 %>% select(subj, Roi, fcCon, rseCon, prop)

t84_l_4 <- rbind(t4_l_4, t8_l_4)
t84_l_4$subj <- factor(t84_l_4$subj)
t84_l_4$Roi <- factor(t84_l_4$Roi, levels=c("ffa", "v1", "v2", "v3", "v4", "v_all"))
```

<br>

연결성 강도를 low, high, 전체의 세 가지로 나누어서 각 관심 영역의 RS/RE 복셀 비율을 나타내면 다음과 같다.

<br>

```{r, collapse=TRUE}
t84_1_allL.5 <- t84_l_4 %>% group_by(subj, Roi, fcCon, rseCon) %>%
  dplyr::summarise(prop=mean(prop)) %>%
  ungroup()

# subject-level, wide format
t84_1_allW.5 <- t84_1_allL.5 %>% spread(key=rseCon, value = prop)

# summary table: grand mean
t84_1_allG.5 <- t84_1_allL.5 %>% group_by(fcCon, Roi, rseCon) %>%
  summarise(prop.m = mean(prop), prop.sd = sd(prop)) %>%
  ungroup()
t84_1_allG.5$prop.se <- Rmisc::summarySEwithin(data = t84_1_allL.5, measurevar = "prop", 
                                              idvar = "subj", withinvars = c("fcCon", "Roi", "rseCon"))$se
t84_1_allG.5$prop.ci <- Rmisc::summarySEwithin(data = t84_1_allL.5, measurevar = "prop", 
                                              idvar = "subj", withinvars = c("fcCon", "Roi", "rseCon"))$ci
t84_1_allG.5 <- t84_1_allG.5 %>% 
  mutate(lower.ci = prop.m-prop.ci,
         upper.ci = prop.m+prop.ci,
         lower.se = prop.m-prop.se,
         upper.se = prop.m+prop.se)
# for between-subject design. check help(summarySE)
# t4_1_allG.5 %>% kable(digits=2)
t84_1_allG.5 %>% select(fcCon, Roi, rseCon, prop.m) %>% spread(key=rseCon, value=prop.m) %>% kable(digits=2)
```

<br>

먼저 연결성을 반영하지 않고, 전체 복셀에서 RS/RE의 비율을 살펴보았다. FFA, V1~V4, All VC에 걸쳐서 대략 7대 3, 6대 4의 비율이 유지되는 것으로 보인다.

<br>

```{r, fig.width= 14, fig.height=6}
t84_1_allL.5.1 <- t84_1_allL.5 %>% filter(fcCon=="all")
t84_1_allG.5.1 <- t84_1_allG.5 %>% filter(fcCon=="all")
t84_1.all.plot5 <- ggplot(data=t84_1_allL.5.1, aes(x=Roi, y=prop, fill=rseCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=0, linetype='dashed', color='gray80', alpha =1, size=1) +
  geom_point(data=t84_1_allL.5.1, aes(x=Roi, y=prop, fill=rseCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t84_1_allG.5.1, aes(x = Roi, y=prop.m, ymin = lower.se, ymax = upper.se),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  scale_x_discrete(labels=c("FFA","V1","V2","V3","V4","all VC")) +
  scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"),  # , "#235796"
                    labels = c("RS voxels", "RE voxels")) +
  coord_cartesian(ylim = c(0, 1), clip = "on") +
  labs(x = " ", y = "Proportion of voxels (%)") +
  # ggtitle("ppa-v connectivity") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.5, 1, 0.5, "cm"), 
        legend.title = element_blank(),
        legend.position=c(0.8, 0.85))

#ggsave("rse_voxels1_ms_plot.jpg", plot = t84_1.all.plot5, width=10, height=6, unit='in', dpi=600)
t84_1.all.plot5

```

<br>

영역 간 차이나 영역, RS/RE 조건 간의 상호작용은 나타나지 않았다.

<br>

```{r, collapse=TRUE}
t84_1.aov5 <- aov_ez(id="subj", dv="prop", data=t84_1_allL.5.1, within = c("Roi","rseCon"))
nice(t84_1.aov5, es="pes")
```

<br>

사후 검정 결과에서도, 영역 간 RS/RE 복셀 비율은 차이가 없는 것처럼 보인다.

<br>

```{r, collapse=TRUE}
t84_1.aov5.m1 <- emmeans(t84_1.aov5, pairwise ~ Roi | rseCon, adjust = "tukey") # adjust="bon" , "tukey", "none"
t84_1.aov5.m1$contrasts %>% kable(digits=4)
# plot(t84_1.aov5.m1, horipropontal = T, comparison=T)
```

<br>

## bgFC 강도에 따른 관심 영역의 RS/RE 복셀 비율 차이

<br>

bgFC 강도를 Median Split하여 Low/High로 구분한 후, 각 관심 시각 영역에서의 RS/RE 복셀 비율이 bgFC 강도와 상호작용하는지 살펴보았다.

<br>


```{r, collapse=TRUE}
t4_l_3 <- t4_l %>% filter(rseCon!="init", rseCon!="rep", rseCon!="rse")
t4_l_4 <- t4_l_3 %>% spread(key=rseCon, value=z)
t4_l_4 <- t4_l_4 %>% mutate(rs_v = n_rs/(n_rs+n_re), re_v = n_re/(n_rs+n_re) )
t4_l_4 <- t4_l_4 %>% select(subj, bgCon, vRoi, fcCon, rs_v, re_v)
t4_l_4 <- gather(t4_l_4, rseCon, prop, c("rs_v", "re_v"), factor_key=T)
```

<br>

요약치는 다음과 같다.

<br>

```{r, collapse=TRUE}
t4_1_allL.5 <- t4_l_4 %>% filter(fcCon!="all") %>% group_by(subj, bgCon, vRoi, fcCon, rseCon) %>%
  dplyr::summarise(prop=mean(prop)) %>%
  ungroup()
# t4_1_allL.5 %>% kable(digits=2)

# subject-level, wide format
t4_1_allW.5 <- t4_1_allL.5 %>% spread(key=rseCon, value = prop)
# t4_1_allW.5 %>% kable(digits=2)

# summary table: grand mean
t4_1_allG.5 <- t4_1_allL.5 %>% group_by(fcCon, vRoi,  rseCon) %>%
  summarise(prop.m = mean(prop), prop.sd = sd(prop)) %>%
  ungroup()
t4_1_allG.5$prop.se <- Rmisc::summarySEwithin(data = t4_1_allL.5, measurevar = "prop", 
                                              idvar = "subj", withinvars = c("fcCon", "vRoi", "rseCon"))$se
t4_1_allG.5$prop.ci <- Rmisc::summarySEwithin(data = t4_1_allL.5, measurevar = "prop", 
                                              idvar = "subj", withinvars = c("fcCon", "vRoi", "rseCon"))$ci
t4_1_allG.5 <- t4_1_allG.5 %>% 
  mutate(lower.ci = prop.m-prop.ci,
         upper.ci = prop.m+prop.ci,
         lower.se = prop.m-prop.se,
         upper.se = prop.m+prop.se)
t4_1_allG.5 %>% select(vRoi, fcCon, rseCon, prop.m) %>% spread(key=rseCon, value=prop.m) %>% kable(digits=2)
```

<br>

A는 각 bgFC 강도에서 시각 영역과 RS/RE비율 간 상호작용을 나타내고, B는 각 시각 영역에서 RS/RE 비율과 bgFC 강도 간의 상호작용을 나타낸다. 점은 평균, errorbar는 95% CI를 표시하였다.

<br>

```{r, fig.width= 16, fig.height=6}
t4_1_allL.5.2 <- t4_1_allL.5 %>% filter(fcCon!="all")
t4_1_allG.5.2 <- t4_1_allG.5 %>% filter(fcCon!="all")
t4_1.all.plot5.2 <- ggplot(data=t4_1_allL.5.2, aes(x=vRoi, y=prop, fill=rseCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=0, linetype='dashed', color='gray80', alpha =1, size=1) +
  geom_point(data=t4_1_allL.5.2, aes(x=vRoi, y=prop, fill=rseCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t4_1_allG.5.2, aes(x = vRoi, y=prop.m, ymin = lower.se, ymax = upper.se),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~fcCon, scales="free_x", space = "free",
             labeller = labeller(fcCon = c("low"="Low bgFC voxels","high"="High bgFC voxels"))) +
  scale_x_discrete(labels=c("V1","V2","V3","V4","all VC")) +
  scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"),  # , "#235796"
                    labels = c("RS voxels", "RE voxels")) +
  coord_cartesian(ylim = c(0, 1.2), clip = "on") +
  labs(x = " ", y = "Proportion of voxels (%)") +
  # ggtitle("ppa-v connectivity") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.5, 1, 0.5, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
# t4_1.all.plot5.2
#ggsave("rse_voxels2_ms_plot.jpg", plot = t4_1.all.plot5.2, width=10, height=6, unit='in', dpi=600)

t4_1_allL.6 <- t4_1_allL.5 %>% filter(fcCon!="all")
t4_1_allG.6 <- t4_1_allG.5 %>% filter(fcCon!="all")
t4_1.all.plot5.1 <- ggplot(data=t4_1_allL.6, aes(x=rseCon, y=prop, fill=fcCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=0, linetype='dashed', color='gray80', alpha =1, size=1) +
  geom_point(data=t4_1_allL.6, aes(x=rseCon, y=prop, fill=fcCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t4_1_allG.6, aes(x = rseCon, y=prop.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~vRoi, scales="free_x", space = "free", 
             labeller = labeller(vRoi = c("v1" = "V1","v2" = "V2","v3" = "V3","v4" = "V4","v_all" = "all VC"))) +
  scale_x_discrete(labels=c("RS","RE")) +
  scale_fill_manual(values = c("#B1D4E0", "#145DA0"),  # , "#235796" "#B1D4E0", "#2E8BC0","#0C2D48","#145DA0"
                    labels = c("low bgFC voxels", "high bgFC voxels")) +
  coord_cartesian(ylim = c(0, 1.2), clip = "on") +
  labs(x = " ", y = "Proportion of voxels (%)") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        # axis.text.x = element_text(face = "plain", vjust=0.2, hjust= 0.5, angle = -35, size = 15, color = "black"), 
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain",size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.5, 1, 0.5, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
# t4_1.all.plot5.1
#ggsave("rse_voxels3_ms_plot.jpg", plot = t4_1.all.plot5.1, width=10, height=6, unit='in', dpi=600)

ggarrange(t4_1.all.plot5.2, t4_1.all.plot5.1, ncol = 2, labels=c("A", "B"))
```

<br>

시각 관심 영역(V1~V4, all VC), bgFC 강도(low, high), RS/RE 복셀비율 (RS 비율, RE 비율)을 요인으로 5 x 2 x 2 혼합 요인 분산분석을 수행하였다. bgFC 강도와 RS/RE 복셀 비율 간의 상호작용이 유의하였다.

<br>

```{r, collapse=TRUE}
t4_1.aov5 <- aov_ez(id="subj", dv="prop", data=t4_1_allL.6, within = c("vRoi","fcCon","rseCon"))
# summary(t4_1.aov5)
nice(t4_1.aov5, es="pes") %>% kable(digits=2)
```

<br>

가설과 일치하게, 연결성이 강한 조건이 약한 조건보다 RS 비율과 RE 비율 간의 차이가 크게 나타나는 것으로 보인다.

<br>

```{r, collapse=TRUE}
t4_1.aov5.m1 <- emmeans(t4_1.aov5, pairwise ~ rseCon | fcCon + vRoi, adjust = "tukey") # adjust="bon" , "tukey", "none"
t4_1.aov5.m1$contrasts %>% kable(digits=3)
# plot(t4_1.aov5.m1, horipropontal = T, comparison=T)
```

<br>

```{r, collapse=TRUE}
t4_1.aov5.m2 <- emmeans(t4_1.aov5, pairwise ~ fcCon | rseCon + vRoi, adjust = "tukey") # adjust="bon" , "tukey", "none"
t4_1.aov5.m2$contrasts %>% kable(digits=3)
# plot(t4_1.aov5.m2, horipropontal = T, comparison=T)
```

<br>


## 각 관심 영역 조건과 bgFC 조건에서 bgFC의 평균값
  
<br>
  
전반적인 연결성 정도를 확인하기 위해 각 관심 영역 조건에서 bgFC 조건의 connectivity 평균값을 표시하였다.

<br>

```{r, collapse=TRUE}
# median split
s2 <- read.csv("data/bg_summary_ms_nsm.csv", header = T)
glimpse(s2, width = 70)
# check number of trials for each condition/subj
table(s2$subj)
table(s2$vRoi, s2$subj) 

s2_l <- gather(s2, fcCon, fc, low_Zr:all_Zr, factor_key=T)


# change class of main factors: double to factor
s2_l$subj = factor(s2_l$subj, levels=c("primeRecon_2", "primeRecon_4", 
                                       "primeRecon_5", "primeRecon_6",
                                       "primeRecon_7", "primeRecon_8", 
                                       "primeRecon_9", "primeRecon_10",
                                       "primeRecon_11", "primeRecon_13",
                                       "primeRecon_14", "primeRecon_15",
                                       "primeRecon_16", "primeRecon_17",
                                       "primeRecon_18", "primeRecon_19",
                                       "primeRecon_20", "primeRecon_21",
                                       "primeRecon_22", "primeRecon_23",
                                       "primeRecon_24"), 
                   labels=c(2,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24))
s2_l <- s2_l %>% filter(subj!=99)
s2_l$vRoi = factor(s2_l$vRoi, levels=c("v1","v2","v3","v4","v_all")) 
s2_l$fcCon = factor(s2_l$fcCon, levels=c("low_Zr", "high_Zr", "all_Zr"), 
                    labels=c("low","high","all")) 

# 4 quantile
s3 <- read.csv("data/bg_summary_qs_nsm.csv", header = T)
s3_l <- gather(s3, fcCon, fc, low_Zr:all_Zr, factor_key=T)
# change class of main factors: double to factor
s3_l$subj = factor(s3_l$subj, levels=c("primeRecon_2", "primeRecon_4", 
                                       "primeRecon_5", "primeRecon_6",
                                       "primeRecon_7", "primeRecon_8", 
                                       "primeRecon_9", "primeRecon_10",
                                       "primeRecon_11", "primeRecon_13",
                                       "primeRecon_14", "primeRecon_15",
                                       "primeRecon_16", "primeRecon_17",
                                       "primeRecon_18", "primeRecon_19",
                                       "primeRecon_20", "primeRecon_21",
                                       "primeRecon_22", "primeRecon_23",
                                       "primeRecon_24"), 
                   labels=c(2,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24))
s3_l <- s3_l %>% filter(subj!=99)
s3_l$vRoi = factor(s3_l$vRoi, levels=c("v1","v2","v3","v4","v_all")) 
s3_l$fcCon = factor(s3_l$fcCon, levels=c("low_Zr", "low_med_Zr","high_med_Zr","high_Zr", "all_Zr"), 
                    labels=c("low","low_med","high_med","high","all")) 

```

<br>

Median split 과 4 Quantile 버전에서 각각의 요약치는 아래와 같다

<br>

**Median Split 버전**

```{r, collapse=TRUE}

# subject-level, long format
s2_allL <- s2_l %>% filter(fcCon!="all") %>% 
  group_by(subj, vRoi, fcCon) %>%
  dplyr::summarise(fc=mean(fc)) %>%
  ungroup()
# s2_allL %>% kable(digits=2)

# subject-level, wide format
s2_allW <- s2_allL %>% spread(key=fcCon, value = fc)
# s2_allW %>% kable(digits=2)

# summary table: grand mean
s2_allG <- s2_allL %>% group_by(vRoi, fcCon) %>%
  summarise(fc.m = mean(fc), fc.sd = sd(fc)) %>%
  ungroup()
s2_allG$fc.se <- Rmisc::summarySEwithin(data = s2_allL, measurevar = "fc", 
                                        idvar = "subj", withinvars = c("vRoi", "fcCon"))$se
s2_allG$fc.ci <- Rmisc::summarySEwithin(data = s2_allL, measurevar = "fc", 
                                        idvar = "subj", withinvars = c("vRoi", "fcCon"))$ci
s2_allG <- s2_allG %>% 
  mutate(lower.ci = fc.m-fc.ci,
         upper.ci = fc.m+fc.ci)
s2_allG %>% select(vRoi, fcCon, fc.m) %>% spread(key=fcCon, value=fc.m) %>%  kable(digits=2)
```

<br>

**4 Quantile 버전**


```{r, collapse=TRUE}
# subject-level, long format
s3_allL <- s3_l %>% filter(fcCon!="all") %>% 
  group_by(subj, vRoi, fcCon) %>%
  dplyr::summarise(fc=mean(fc)) %>%
  ungroup()
# s3_allL %>% kable(digits=2)

# subject-level, wide format
s3_allW <- s3_allL %>% spread(key=fcCon, value = fc)
# s3_allW %>% kable(digits=2)

# summary table: grand mean
s3_allG <- s3_allL %>% group_by(vRoi, fcCon) %>%
  summarise(fc.m = mean(fc), fc.sd = sd(fc)) %>%
  ungroup()
s3_allG$fc.se <- Rmisc::summarySEwithin(data = s3_allL, measurevar = "fc", 
                                        idvar = "subj", withinvars = c("vRoi", "fcCon"))$se
s3_allG$fc.ci <- Rmisc::summarySEwithin(data = s3_allL, measurevar = "fc", 
                                        idvar = "subj", withinvars = c("vRoi", "fcCon"))$ci
s3_allG <- s3_allG %>% 
  mutate(lower.ci = fc.m-fc.ci,
         upper.ci = fc.m+fc.ci)
s3_allG %>% select(vRoi, fcCon, fc.m) %>% spread(key=fcCon, value=fc.m) %>%  kable(digits=2)

```

<br>

그래포로 나타나면 아래와 같다.

<br>

```{r, fig.width= 12, fig.height= 14}
s2.all.plot1 <- ggplot(data=s2_allL, aes(x=vRoi, y=fc, fill=fcCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_point(data=s2_allL, aes(x=vRoi, y=fc, fill=fcCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=s2_allG, aes(x = vRoi, y=fc.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  scale_x_discrete(labels=c("V1","V2","V3","V4","all VC")) +
  scale_fill_manual(values = c("#AFDBF5", "#051422"),  # , "#235796"
                    labels = c("Low",  "High")) +
  
  coord_cartesian(ylim = c(-0.2, 0.5), clip = "on") +
  labs(x = "", y = "BgFC (Zr), by Median Split") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
# s2.all.plot1
#ggsave("bg_ms_plot1.jpg", plot = s2.all.plot1, width=8, height=8, unit='in', dpi=600)

s3.all.plot1 <- ggplot(data=s3_allL, aes(x=vRoi, y=fc, fill=fcCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_point(data=s3_allL, aes(x=vRoi, y=fc, fill=fcCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=s3_allG, aes(x = vRoi, y=fc.m, ymin = lower.ci, ymax = upper.ci),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  scale_x_discrete(labels=c("V1","V2","V3","V4","all VC")) +
  scale_fill_manual(values = c("#AFDBF5", "#195779", "#5BAED9", "#051422"),  # , "#235796"
                    labels = c("Lowest", "Low",  "High",  "Highest")) +
  coord_cartesian(ylim = c(-0.2, 0.5), clip = "on") +
  labs(x = "", y = "BgFC (Zr), by 4 Quantile Split") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
# s3.all.plot1
#ggsave("bg_qs_plot2.jpg", plot = s3.all.plot1, width=8, height=8, unit='in', dpi=600)

s23.plot1 <- ggarrange(s2.all.plot1, s3.all.plot1, nrow = 2)
#ggsave("bg_qsms_plot.jpg", plot = s23.plot1, width=10, height=8, unit='in', dpi=600)
s23.plot1
```

<br>


# Results 2 - Visual RS/RE voxel - FFA RS/RE voxel 간의 bgFC

<br>

Predictive Coding Model을 RSE에 적용한다고 했을 때, RS는 Representation unit, RE는 Error unit에 대응될 수 있다. PC에서 Error 유닛은 상위 영역의 Representation unit에 Feedforward signal을 전송한다. 단순하게 연결성의 맥락으로 옮겨서보자면, 하위 영역의 RE와 상위 영역의 RS 간 연결성이 강하게 나타날 수 있다. **(그렇다면 상위 영역에서의 prediction, feedback signal은 어디에서 오는가..?)**

<br>

상위 영역인 FFA를 RS/RE로 구분하고 하위 영역인 VC의 RS/RE와의 연결성을 분석해볼 수 있다. 이 경우 2 x 2의 4가지 연결성이 계산될 수 있다. 
만약 PC를 그대로 적용한 가설이 맞는다면, VC의 RE와 FFA의 RS간 연결성이 다른 연결성보다 강하게 나타날 것이다. VC RE - FFA RE, VC RS - FFA RS, VC RS - FFA RE는 어떻게 될 것인가? 현재 이 세가지 비교에 대해서는 특별한 가설이 없다. 일단 확인해보자.

<br> 

**+ 추가로 해볼 것, 이전 분석(Results 1)에서는 전체 FFA의 time Course를 활용했다. 이것을 RS/RE로 나눠본다면 어떨까?**

<br>


## Visual RS/RE voxel과 상위 영역 RS/RE voxel 간의 연결성

<br>

상위 영역인 FFA를 RS/RE로 구분하고 하위 영역인 VC의 RS/RE와의 연결성을 분석하였다. 

<br>


```{r, collapse=TRUE}
t7 <- read.csv("data/bg_summary_gc_nsm.csv", header = T)
t7_l <- t7
t7_l$subj = factor(t7_l$subj, levels=c("primeRecon_2", "primeRecon_4",
                                       "primeRecon_5", "primeRecon_6",
                                       "primeRecon_7", "primeRecon_8",
                                       "primeRecon_9", "primeRecon_10",
                                       "primeRecon_11", "primeRecon_13",
                                       "primeRecon_14", "primeRecon_15",
                                       "primeRecon_16", "primeRecon_17",
                                       "primeRecon_18", "primeRecon_19",
                                       "primeRecon_20", "primeRecon_21",
                                       "primeRecon_22", "primeRecon_23",
                                       "primeRecon_24"),
                   labels=c(2,4,5,6,7,8,9,10,11,13,14,15,16,17,18,19,20,21,22,23,24))
t7_l <- t7_l %>% filter(subj!=99)
t7_l$ffa_type = factor(t7_l$ffa_type, levels = c("ffa_rs","ffa_re"))
t7_l$v_type = factor(t7_l$v_type, levels = c("v1_rs","v2_rs","v3_rs","v4_rs","all_v_rs",
                                             "v1_re","v2_re","v3_re","v4_re","all_v_re"),
                     labels=c("v1_rs","v2_rs","v3_rs","v4_rs","all_rs",
                              "v1_re","v2_re","v3_re","v4_re","all_re"))
t7_l <- t7_l %>% separate(col=v_type, sep="_", into=c("vRoi", "rsCon"))
t7_l$vRoi <- factor(t7_l$vRoi, levels = c("v1", "v2", "v3", "v4", "all"),
                    labels=c("v1", "v2", "v3", "v4", "all_vc"))
t7_l$rsCon <- factor(t7_l$rsCon, levels = c("rs", "re"))

glimpse(t7_l, width = 70)
```

<br>

요약치는 다음과 같다.

<br>

```{r, collapse=TRUE}
# subject-level, long format
t7_allL <- t7_l %>% group_by(subj, ffa_type, vRoi, rsCon) %>%
  dplyr::summarise(Zr=mean(Zr)) %>%
  ungroup()
# t7_allL %>% kable(digits=2)

# subject-level, wide format
t7_allW <- t7_allL %>% spread(key=ffa_type, value = Zr)
# t7_allW %>% kable(digits=2)

t7_allW1 <- t7_allL %>% spread(key=vRoi, value = Zr)
# t7_allW1 %>% kable(digits=2)

# summary table: grand mean
t7_allG <- t7_allL %>% group_by(ffa_type, vRoi, rsCon) %>%
  summarise(Zr.m = mean(Zr), Zr.sd = sd(Zr)) %>%
  ungroup()
t7_allG$Zr.se <- Rmisc::summarySEwithin(data = t7_allL, measurevar = "Zr", 
                                        idvar = "subj", withinvars = c("vRoi", "rsCon", "ffa_type"))$se
t7_allG$Zr.ci <- Rmisc::summarySEwithin(data = t7_allL, measurevar = "Zr", 
                                        idvar = "subj", withinvars = c("vRoi", "rsCon", "ffa_type"))$ci
t7_allG <- t7_allG %>% 
  mutate(lower.ci = Zr.m-Zr.ci,
         upper.ci = Zr.m+Zr.ci,
         lower.se = Zr.m-Zr.se,
         upper.se = Zr.m+Zr.se)
t7_allG<-t7_allG %>% select(vRoi, ffa_type, rsCon, Zr.m, Zr.sd, Zr.se, Zr.ci, lower.ci, upper.ci, lower.se, upper.se)
t7_allG %>% select(vRoi, ffa_type, rsCon, Zr.m) %>% spread(ffa_type, Zr.m) %>% kable(digits=2)
```

<br>

전반적으로 높은 연결성을 보인다. **이렇게 높은 연결성은 무엇에 의해 나타나는가? prediction signal?, granger causality analysis를 해볼 수 있을까?**

<br>

어쨌든, 가설과 다르게, FFA의 RS와 VC의 RS 간 연결성이 FFA RS - VC RE 연결성보다 강하게 나타났다. 흥미롭게도, v3과 v4에서는 FFA RS - VC RE 간 연결성이 FFA RE - VC RE 보다 높게 나타났다. 이는 PC 모형에서 Error unit과 Rerepresentation Unit 간의 연결로 해석할 수 있는 가능성을 보여준다. RS가 Representation Unit (RU)이라고 한다면, FFA의 RU와 VC의 RU 간 강한 연결성은 자극에 대한 Representation 자체, 또는 sensory forward signal에 기인할 수 있다 (PC 모델 그림에서는 이 연결을 표시하지 않고 있는데, Forward Sensory Signal이 있는 것으로 보는게 타당할 것이다.). 아니면.. Prediction의 Feedback Signal이거나...  RE를 Error Unit (EU)이라고 한다면, FFA의 RU와 VC의 EU 간 강한 연결성은 Prediction Error에 의한 Forward Signal일 수 있다. 이 가설을 검증하기 위해서는 VC RU <-> FFA RU, VC EU -> FFA EU 의 Effective Connectivity 패턴이 나타날 가능성이 있다 (VC RU <-> FFA RU 에서의 방향성은 추가적인 검토가 필요하다. Forward Signal인가? Feedback Signal인가?, 또 V1 & V2에서는 왜 안나타나는가? 너무 먼 hierarchy라서?). 일단 어느 방향으로 가정을 하든, Granger Causality Analysis를 통해 방향성이 존재하는지 살펴볼 수는 있을 것이다. 

<br>

또 한가지 흥미로운 점은 FFA의 RS 복셀들은 전반적으로 하위 영역의 RS/RE와 높은 연결성을 보이는데, FFA의 RE 복셀들은 조건간 차이를 보이지 않는다는 점이다. Error unit이 forward signal을 투사하는 방식으로 상위 영역과 연결되어 있다는 점을 적용하여 설명할 수 있는 것으로 보인다. 

<br>

한가지 고려해야하는 점은, Results 1의 분석에서 RE의 효과 크기나 RE 복셀의 비율 자체는 상위 영역과의 연결성이 강할수록 감소했다는 점이다. 물론 여기서 상위 영역인 FFA는 RS/RE를 구분하지 않았다. RS 복셀이 RE 복셀보다 더 많다는 것을 생각해보면 RS 복셀들의 time course가 전체 FFA time course에 반영될 가능성이 크다. **추가 분석으로 FFA RS, FFA RE를 기준으로 Results 1의 분석을 다시 해볼 필요가 있다.**

<br>

```{r, fig.width= 16, fig.height=6}
t7.all.plot7.1 <- ggplot(data=t7_allL, aes(x=ffa_type, y=Zr, fill=rsCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_point(data=t7_allL, aes(x=ffa_type, y=Zr, fill=rsCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t7_allG, aes(x = ffa_type, y=Zr.m, ymin = lower.se, ymax = upper.se),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~vRoi, scales="free_x", space = "free",
             labeller = labeller(vRoi = c("v1" = "V1","v2" = "V2","v3" = "V3","v4" = "V4", "all_vc" = "all VC"))) +
  scale_x_discrete(labels=c("RS","RE")) +
  scale_fill_manual(values = c("#feb24c", "#91bfdb"), # c("#feb24c", "#91bfdb"),
                    labels = c("VC RS voxel", "VC RE voxel")) +
  coord_cartesian(ylim = c(-0.2, 0.7), clip = "on") +
  labs(x = "FFA", y = "Background Connectivity (Zr)") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
# t7.all.plot7.1
#ggsave("bg_ffa_plot1.jpg", plot = t7.all.plot7.1, width=12, height=8, unit='in', dpi=600)

t7.all.plot7.2 <- ggplot(data=t7_allL, aes(x=vRoi, y=Zr, fill=ffa_type)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_point(data=t7_allL, aes(x=vRoi, y=Zr, fill=ffa_type), position = position_dodge(width=0.8),
           size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t7_allG, aes(x =vRoi, y=Zr.m, ymin = lower.se, ymax = upper.se),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~rsCon, scales="free_x", space = "free",
             labeller = labeller(rsCon = c("rs" = "Visual RS voxel","re" = "Visual RE voxel"))) +
  scale_x_discrete(labels=c("V1","V3","V3","V4","all VC")) +
  scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"),  # , "#235796"
                    labels = c("FFA RS voxel", "FFA RE voxel")) +
  coord_cartesian(ylim = c(-0.2, 0.7), clip = "on") +
  labs(x = "Visucal Cortex", y = "Background Connectivity (Zr)") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
# t7.all.plot7.2
#ggsave("bg_ffa_plot2.jpg", plot = t7.all.plot7.2, width=12, height=8, unit='in', dpi=600)

t7.all.plot7.3 <- ggplot(data=t7_allL, aes(x=rsCon, y=Zr, fill=ffa_type)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_point(data=t7_allL, aes(x=rsCon, y=Zr, fill=ffa_type), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t7_allG, aes(x =rsCon, y=Zr.m, ymin = lower.se, ymax = upper.se),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~vRoi, scales="free_x", space = "free",
             labeller = labeller(vRoi = c("v1" = "V1","v2" = "V2","v3" = "V3","v4" = "V4", "all_vc" = "all VC"))) +
  scale_x_discrete(labels=c("RS","RE")) +
  scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"),  # , "#235796"
                    labels = c("FFA RS voxel", "FFA RE voxel")) +
  coord_cartesian(ylim = c(-0.2, 0.7), clip = "on") +
  labs(x = "Visual Cortex", y = "Background Connectivity (Zr)") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
# t7.all.plot7.3
#ggsave("bg_ffa_plot3.jpg", plot = t7.all.plot7.3, width=12, height=8, unit='in', dpi=600)

# 
ggarrange(t7.all.plot7.1, t7.all.plot7.3,
          ncol=2, labels=c("A","B"))

```

<br>

시각 관심 영역(V1 ~ V4, all VC), FFA의 RS/RE, VC의 RS/RE를 요인으로 5 x 2 x 2 혼합 요인 분산분석을 수행하였다. 다른 것도 있지만, 주목할만한 점으로는 VC의 RS/RE와 FFA의 RS/RE 간의 상호작용이 유의하였다.

<br>


```{r, collapse=TRUE}
t7_allL.1 <- t7_allL
t7.aov1 <- aov_ez(id="subj", dv="Zr", data = t7_allL.1, within = c("vRoi", "rsCon", "ffa_type"))
nice(t7.aov1, es="pes") %>% kable(digits=2)
```

<br>

사후 분석 결과, FFA RS 에서 VC RS 와 VC RE 간 차이가 유의하였다.구체적으로 FFA RS-VC RS의 연결성 강도가 크게 나타났다.

<br>

```{r, collapse=TRUE}
t7.aov1.m2 <- emmeans(t7.aov1, pairwise ~ rsCon | ffa_type + vRoi , adjust = "tukey") # adjust="bon" , "tukey", "none"
t7.aov1.m2$contrasts %>% kable(digits=3)
# plot(t7.aov1.m2, horizontal = T, comparison=T)
```

<br>

V4의 VC RE 에서 FFA RS와 FFA RE 간 차이가 유의하였다. V3에서는 Marginal한 차이를 보였다. 구체적으로 VC RE-FFA RS의 연결성 강도가 VC RE-FFA RE 보다 크게 나타났다. V1, V2에서는 이런 효과가 나타나지 않았는데, 효과가 충분하지 않은 것인지, Error signal의 연결이 V1 -> V2 -> V3 -> V4로 흐르기 때문에 hierarchy 상 거리가 멀어서 그렇게 나타난 것인지 알 수 없다. 또한 이 데이터에는 Meridian Mapping이 없어서 VC ROI가 부정확할 가능성도 있다. 

<br>

```{r, collapse=TRUE}
t7.aov1.m1 <- emmeans(t7.aov1, pairwise ~ ffa_type | rsCon + vRoi, adjust = "tukey") # adjust="bon" , "tukey", "none"
t7.aov1.m1$contrasts %>% kable(digits=3)
# plot(t7.aov1.m1, horizontal = T, comparison=T)
```

## Visual RS/RE와 상위 영역 RS/RE 간의 유효 연결성

<br>



<br>
```{r, collapse=TRUE}
# subject-level, long format
t8_l <- t7_l
thr = t8_l$vc2ffa_cv[1]

t8_l <- gather(t8_l, dirt, F, c(vc2ffa_F, ffa2vc_F), factor_key=TRUE)
t8_l$dirt <- factor(t8_l$dirt, levels = c('vc2ffa_F', 'ffa2vc_F'), labels=c('forward','back'))

t8_allL <- t8_l %>% group_by(subj, ffa_type, vRoi, rsCon, dirt) %>%
  dplyr::summarise(F=mean(F)) %>%
  ungroup()
# t8_allL %>% kable(digits=2)

# subject-level, wide format
t8_allW <- t8_allL %>% spread(key=ffa_type, value = F)
# t8_allW %>% kable(digits=2)

t8_allW1 <- t8_allL %>% spread(key=vRoi, value = F)
# t8_allW1 %>% kable(digits=2)

# t8_allW2 <- t8_allL %>% spread(key=dirt, value = F)
# t8_allW2 %>% kable(digits=2)

# summary table: grand mean
t8_allG <- t8_allL %>% group_by(ffa_type, vRoi, rsCon, dirt) %>%
  summarise(F.m = mean(F), F.sd = sd(F)) %>%
  ungroup()
t8_allG$F.se <- Rmisc::summarySEwithin(data = t8_allL, measurevar = "F", 
                                        idvar = "subj", withinvars = c("vRoi", "rsCon", "ffa_type", "dirt"))$se
t8_allG$F.ci <- Rmisc::summarySEwithin(data = t8_allL, measurevar = "F", 
                                        idvar = "subj", withinvars = c("vRoi", "rsCon", "ffa_type", "dirt"))$ci
t8_allG <- t8_allG %>% 
  mutate(lower.ci = F.m-F.ci,
         upper.ci = F.m+F.ci,
         lower.se = F.m-F.se,
         upper.se = F.m+F.se)
t8_allG<-t8_allG %>% select(vRoi, ffa_type, rsCon, dirt, F.m, F.sd, F.se, F.ci, lower.ci, upper.ci, lower.se, upper.se)
t8_allG %>% select(vRoi, ffa_type, rsCon, dirt, F.m) %>% spread(ffa_type, F.m) %>% kable(digits=2)
```


<br>

```{r, fig.width= 16, fig.height=6}
t8_allL.1 <- t8_allL %>% filter(ffa_type == "ffa_rs")
t8_allG.1 <- t8_allG %>% filter(ffa_type == "ffa_rs")
t8.all.plot8.1 <- ggplot(data=t8_allL.1, aes(x=dirt, y=F, fill=rsCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
  geom_point(data=t8_allL.1, aes(x=dirt, y=F, fill=rsCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t8_allG.1, aes(x = dirt, y=F.m, ymin = lower.se, ymax = upper.se),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~vRoi, scales="free_x", space = "free",
             labeller = labeller(vRoi = c("v1" = "V1","v2" = "V2","v3" = "V3","v4" = "V4", "all_vc" = "all VC"))) +
  scale_x_discrete(labels=c("to FFA","from FFA")) +
  scale_fill_manual(values = c("#feb24c", "#91bfdb"), # c("#feb24c", "#91bfdb"),
                    labels = c("VC RS voxel", "VC RE voxel")) +
  coord_cartesian(ylim = c(0, 100), clip = "on") +
  labs(x = "FFA RS", y = "Granger Causality F Value") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
#t8.all.plot8.1

t8_allL.2 <- t8_allL %>% filter(ffa_type == "ffa_re")
t8_allG.2 <- t8_allG %>% filter(ffa_type == "ffa_re")
t8.all.plot8.2 <- ggplot(data=t8_allL.2, aes(x=dirt, y=F, fill=rsCon)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
  geom_point(data=t8_allL.2, aes(x=dirt, y=F, fill=rsCon), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t8_allG.2, aes(x = dirt, y=F.m, ymin = lower.se, ymax = upper.se),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~vRoi, scales="free_x", space = "free",
             labeller = labeller(vRoi = c("v1" = "V1","v2" = "V2","v3" = "V3","v4" = "V4", "all_vc" = "all VC"))) +
  scale_x_discrete(labels=c("to FFA","from FFA")) +
  scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"), # c("#feb24c", "#91bfdb"),
                    labels = c("VC RS voxel", "VC RE voxel")) +
  coord_cartesian(ylim = c(0, 100), clip = "on") +
  labs(x = "FFA RE", y = "Granger Causality F Value") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
#t8.all.plot8.2
ggarrange(t8.all.plot8.1, t8.all.plot8.2,
          ncol=2, labels=c("A","B"))
```

<br>

```{r, fig.width= 16, fig.height=6}

t8_allL.1 <- t8_allL %>% filter(ffa_type == "ffa_rs")
t8_allG.1 <- t8_allG %>% filter(ffa_type == "ffa_rs")
t8.all.plot8.3 <- ggplot(data=t8_allL.1, aes(x=rsCon, y=F, fill=dirt)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
  geom_point(data=t8_allL.1, aes(x=rsCon, y=F, fill=dirt), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t8_allG.1, aes(x = rsCon, y=F.m, ymin = lower.se, ymax = upper.se),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~vRoi, scales="free_x", space = "free",
             labeller = labeller(vRoi = c("v1" = "V1","v2" = "V2","v3" = "V3","v4" = "V4", "all_vc" = "all VC"))) +
  scale_x_discrete(labels=c("RS","RE")) +
  scale_fill_manual(values = c("#feb24c", "#91bfdb"), # c("#feb24c", "#91bfdb"),
                    labels = c("Forward to FFA RS", "Back from FFA RS")) +
  coord_cartesian(ylim = c(0, 100), clip = "on") +
  labs(x = "VC RS/RE", y = "Granger Causality F Value") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
#t8.all.plot8.3

t8_allL.2 <- t8_allL %>% filter(ffa_type == "ffa_re")
t8_allG.2 <- t8_allG %>% filter(ffa_type == "ffa_re")
t8.all.plot8.4 <- ggplot(data=t8_allL.2, aes(x=rsCon, y=F, fill=dirt)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
  geom_point(data=t8_allL.2, aes(x=rsCon, y=F, fill=dirt), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t8_allG.2, aes(x = rsCon, y=F.m, ymin = lower.se, ymax = upper.se),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~vRoi, scales="free_x", space = "free",
             labeller = labeller(vRoi = c("v1" = "V1","v2" = "V2","v3" = "V3","v4" = "V4", "all_vc" = "all VC"))) +
  scale_x_discrete(labels=c("RS","RE")) +
  scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"), # c("#feb24c", "#91bfdb"),
                    labels = c("Forward to FFA RE", "Back from FFA RE")) +
  coord_cartesian(ylim = c(0, 100), clip = "on") +
  labs(x = "VC RS/RE", y = "Granger Causality F Value") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
#t8.all.plot8.4
ggarrange(t8.all.plot8.3, t8.all.plot8.4,
          ncol=2, labels=c("A","B"))
```

<br>

```{r, fig.width= 16, fig.height=6}
# t8_allL.3 <- t8_allL %>% filter(vRoi == "v1")
# t8_allG.3 <- t8_allG %>% filter(vRoi == "v1")
# t8.all.plot8.5 <- ggplot(data=t8_allL.3, aes(x=rsCon, y=F, fill=dirt)) +
#   stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
#   geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
#   geom_point(data=t8_allL.3, aes(x=rsCon, y=F, fill=dirt), position = position_dodge(width=0.8),
#              size=2, show.legend=F, color="gray80") +
#   geom_pointrange(data=t8_allG.3, aes(x = rsCon, y=F.m, ymin = lower.se, ymax = upper.se),
#                   position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
#   facet_grid(.~ffa_type, scales="free_x", space = "free",
#              labeller = labeller(ffa_type = c("ffa_rs" = "FFA RS","ffa_re" = "FFA RE"))) +
#   scale_x_discrete(labels=c("RS","RE")) +
#   scale_fill_manual(values = c("#feb24c", "#91bfdb"), # c("#feb24c", "#91bfdb"),
#                     labels = c("FeedForward", "FeedBack")) +
#   coord_cartesian(ylim = c(0, 100), clip = "on") +
#   labs(x = "V3", y = "Granger Causality F Value") +
#   theme_bw(base_size = 18) +
#   theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
#         axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
#         axis.line=element_line(),
#         strip.text.x = element_text(face = "plain", size = 15, color = "black"),
#         strip.background = element_blank(),
#         panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         panel.border = element_blank(),
#         panel.spacing=unit(1, "lines"),
#         plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
#         legend.title = element_blank(),
#         legend.position="top")
# #t8.all.plot8.5
# 
# t8.all.plot8.6 <- ggplot(data=t8_allL.3, aes(x=ffa_type, y=F, fill=dirt)) +
#   stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
#   geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
#   geom_point(data=t8_allL.3, aes(x=ffa_type, y=F, fill=dirt), position = position_dodge(width=0.8),
#              size=2, show.legend=F, color="gray80") +
#   geom_pointrange(data=t8_allG.3, aes(x = ffa_type, y=F.m, ymin = lower.se, ymax = upper.se),
#                   position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
#   facet_grid(.~rsCon, scales="free_x", space = "free",
#              labeller = labeller(rsCon = c("rs" = "V1 RS","re" = "V1 RE"))) +
#   scale_x_discrete(labels=c("RS","RE")) +
#   scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"), # c("#feb24c", "#91bfdb"),
#                     labels = c("FeedForward", "Feedback")) +
#   coord_cartesian(ylim = c(0, 120), clip = "on") +
#   labs(x = "FFA", y = "Granger Causality F Value") +
#   theme_bw(base_size = 18) +
#   theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
#         axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
#         axis.line=element_line(),
#         strip.text.x = element_text(face = "plain", size = 15, color = "black"),
#         strip.background = element_blank(),
#         panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         panel.border = element_blank(),
#         panel.spacing=unit(1, "lines"),
#         plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
#         legend.title = element_blank(),
#         legend.position="top")
# #t8.all.plot8.6
# ggarrange(t8.all.plot8.5, t8.all.plot8.6,
#           ncol=2, labels=c("A","B"))

```

<br>

```{r, fig.width= 16, fig.height=6}
# t8_allL.3 <- t8_allL %>% filter(vRoi == "v2")
# t8_allG.3 <- t8_allG %>% filter(vRoi == "v2")
# t8.all.plot8.5 <- ggplot(data=t8_allL.3, aes(x=rsCon, y=F, fill=dirt)) +
#   stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
#   geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
#   geom_point(data=t8_allL.3, aes(x=rsCon, y=F, fill=dirt), position = position_dodge(width=0.8),
#              size=2, show.legend=F, color="gray80") +
#   geom_pointrange(data=t8_allG.3, aes(x = rsCon, y=F.m, ymin = lower.se, ymax = upper.se),
#                   position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
#   facet_grid(.~ffa_type, scales="free_x", space = "free",
#              labeller = labeller(ffa_type = c("ffa_rs" = "FFA RS","ffa_re" = "FFA RE"))) +
#   scale_x_discrete(labels=c("RS","RE")) +
#   scale_fill_manual(values = c("#feb24c", "#91bfdb"), # c("#feb24c", "#91bfdb"),
#                     labels = c("FeedForward", "FeedBack")) +
#   coord_cartesian(ylim = c(0, 100), clip = "on") +
#   labs(x = "V2", y = "Granger Causality F Value") +
#   theme_bw(base_size = 18) +
#   theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
#         axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
#         axis.line=element_line(),
#         strip.text.x = element_text(face = "plain", size = 15, color = "black"),
#         strip.background = element_blank(),
#         panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         panel.border = element_blank(),
#         panel.spacing=unit(1, "lines"),
#         plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
#         legend.title = element_blank(),
#         legend.position="top")
# #t8.all.plot8.5
# 
# t8.all.plot8.6 <- ggplot(data=t8_allL.3, aes(x=ffa_type, y=F, fill=dirt)) +
#   stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
#   geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
#   geom_point(data=t8_allL.3, aes(x=ffa_type, y=F, fill=dirt), position = position_dodge(width=0.8),
#              size=2, show.legend=F, color="gray80") +
#   geom_pointrange(data=t8_allG.3, aes(x = ffa_type, y=F.m, ymin = lower.se, ymax = upper.se),
#                   position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
#   facet_grid(.~rsCon, scales="free_x", space = "free",
#              labeller = labeller(rsCon = c("rs" = "V2 RS","re" = "V2 RE"))) +
#   scale_x_discrete(labels=c("RS","RE")) +
#   scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"), # c("#feb24c", "#91bfdb"),
#                     labels = c("FeedForward", "Feedback")) +
#   coord_cartesian(ylim = c(0, 120), clip = "on") +
#   labs(x = "FFA", y = "Granger Causality F Value") +
#   theme_bw(base_size = 18) +
#   theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
#         axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
#         axis.line=element_line(),
#         strip.text.x = element_text(face = "plain", size = 15, color = "black"),
#         strip.background = element_blank(),
#         panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         panel.border = element_blank(),
#         panel.spacing=unit(1, "lines"),
#         plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
#         legend.title = element_blank(),
#         legend.position="top")
# #t8.all.plot8.6
# ggarrange(t8.all.plot8.5, t8.all.plot8.6,
#           ncol=2, labels=c("A","B"))

```

<br>

```{r, fig.width= 16, fig.height=6}
# t8_allL.3 <- t8_allL %>% filter(vRoi == "v3")
# t8_allG.3 <- t8_allG %>% filter(vRoi == "v3")
# t8.all.plot8.5 <- ggplot(data=t8_allL.3, aes(x=rsCon, y=F, fill=dirt)) +
#   stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
#   geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
#   geom_point(data=t8_allL.3, aes(x=rsCon, y=F, fill=dirt), position = position_dodge(width=0.8),
#              size=2, show.legend=F, color="gray80") +
#   geom_pointrange(data=t8_allG.3, aes(x = rsCon, y=F.m, ymin = lower.se, ymax = upper.se),
#                   position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
#   facet_grid(.~ffa_type, scales="free_x", space = "free",
#              labeller = labeller(ffa_type = c("ffa_rs" = "FFA RS","ffa_re" = "FFA RE"))) +
#   scale_x_discrete(labels=c("RS","RE")) +
#   scale_fill_manual(values = c("#feb24c", "#91bfdb"), # c("#feb24c", "#91bfdb"),
#                     labels = c("FeedForward", "FeedBack")) +
#   coord_cartesian(ylim = c(0, 100), clip = "on") +
#   labs(x = "V3", y = "Granger Causality F Value") +
#   theme_bw(base_size = 18) +
#   theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
#         axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
#         axis.line=element_line(),
#         strip.text.x = element_text(face = "plain", size = 15, color = "black"),
#         strip.background = element_blank(),
#         panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         panel.border = element_blank(),
#         panel.spacing=unit(1, "lines"),
#         plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
#         legend.title = element_blank(),
#         legend.position="top")
# #t8.all.plot8.5
# 
# t8.all.plot8.6 <- ggplot(data=t8_allL.3, aes(x=ffa_type, y=F, fill=dirt)) +
#   stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
#   geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
#   geom_point(data=t8_allL.3, aes(x=ffa_type, y=F, fill=dirt), position = position_dodge(width=0.8),
#              size=2, show.legend=F, color="gray80") +
#   geom_pointrange(data=t8_allG.3, aes(x = ffa_type, y=F.m, ymin = lower.se, ymax = upper.se),
#                   position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
#   facet_grid(.~rsCon, scales="free_x", space = "free",
#              labeller = labeller(rsCon = c("rs" = "V3 RS","re" = "V3 RE"))) +
#   scale_x_discrete(labels=c("RS","RE")) +
#   scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"), # c("#feb24c", "#91bfdb"),
#                     labels = c("FeedForward", "Feedback")) +
#   coord_cartesian(ylim = c(0, 120), clip = "on") +
#   labs(x = "FFA", y = "Granger Causality F Value") +
#   theme_bw(base_size = 18) +
#   theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
#         axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
#         axis.line=element_line(),
#         strip.text.x = element_text(face = "plain", size = 15, color = "black"),
#         strip.background = element_blank(),
#         panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         panel.border = element_blank(),
#         panel.spacing=unit(1, "lines"),
#         plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
#         legend.title = element_blank(),
#         legend.position="top")
# #t8.all.plot8.6
# ggarrange(t8.all.plot8.5, t8.all.plot8.6,
#           ncol=2, labels=c("A","B"))

```

<br>

```{r, fig.width= 16, fig.height=6}
t8_allL.3 <- t8_allL %>% filter(vRoi == "v4")
t8_allG.3 <- t8_allG %>% filter(vRoi == "v4")
t8.all.plot8.5 <- ggplot(data=t8_allL.3, aes(x=rsCon, y=F, fill=dirt)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
  geom_point(data=t8_allL.3, aes(x=rsCon, y=F, fill=dirt), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t8_allG.3, aes(x = rsCon, y=F.m, ymin = lower.se, ymax = upper.se),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~ffa_type, scales="free_x", space = "free",
             labeller = labeller(ffa_type = c("ffa_rs" = "FFA RS","ffa_re" = "FFA RE"))) +
  scale_x_discrete(labels=c("RS","RE")) +
  scale_fill_manual(values = c("#feb24c", "#91bfdb"), # c("#feb24c", "#91bfdb"),
                    labels = c("FeedForward", "FeedBack")) +
  coord_cartesian(ylim = c(0, 100), clip = "on") +
  labs(x = "V4", y = "Granger Causality F Value") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
#t8.all.plot8.5

t8.all.plot8.6 <- ggplot(data=t8_allL.3, aes(x=ffa_type, y=F, fill=dirt)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
  geom_point(data=t8_allL.3, aes(x=ffa_type, y=F, fill=dirt), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t8_allG.3, aes(x = ffa_type, y=F.m, ymin = lower.se, ymax = upper.se),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~rsCon, scales="free_x", space = "free",
             labeller = labeller(rsCon = c("rs" = "V4 RS","re" = "V4 RE"))) +
  scale_x_discrete(labels=c("RS","RE")) +
  scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"), # c("#feb24c", "#91bfdb"),
                    labels = c("FeedForward", "Feedback")) +
  coord_cartesian(ylim = c(0, 120), clip = "on") +
  labs(x = "FFA", y = "Granger Causality F Value") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
#t8.all.plot8.6
ggarrange(t8.all.plot8.5, t8.all.plot8.6,
          ncol=2, labels=c("A","B"))

t8.all.plot8.7 <- ggplot(data=t8_allL.3, aes(x=rsCon, y=F, fill=ffa_type)) +
  stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
  geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
  geom_point(data=t8_allL.3, aes(x=rsCon, y=F, fill=ffa_type), position = position_dodge(width=0.8),
             size=2, show.legend=F, color="gray80") +
  geom_pointrange(data=t8_allG.3, aes(x = rsCon, y=F.m, ymin = lower.se, ymax = upper.se),
                  position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
  facet_grid(.~dirt, scales="free_x", space = "free",
             labeller = labeller(dirt = c("forward" = "V4 to FFA","back" = "FFA to V4"))) +
  scale_x_discrete(labels=c("RS","RE")) +
  scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"), # c("#feb24c", "#91bfdb"),
                    labels = c("FFA RS", "FFA RE")) +
  coord_cartesian(ylim = c(0, 120), clip = "on") +
  labs(x = "V4", y = "Granger Causality F Value") +
  theme_bw(base_size = 18) +
  theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
        axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
        axis.line=element_line(),
        strip.text.x = element_text(face = "plain", size = 15, color = "black"),
        strip.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.border = element_blank(),
        panel.spacing=unit(1, "lines"),
        plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
        legend.title = element_blank(),
        legend.position="top")
t8.all.plot8.7

```

<br>

```{r, fig.width= 16, fig.height=6}
# t8_allL.3 <- t8_allL %>% filter(vRoi == "all_vc")
# t8_allG.3 <- t8_allG %>% filter(vRoi == "all_vc")
# t8.all.plot8.5 <- ggplot(data=t8_allL.3, aes(x=rsCon, y=F, fill=dirt)) +
#   stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
#   geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
#   geom_point(data=t8_allL.3, aes(x=rsCon, y=F, fill=dirt), position = position_dodge(width=0.8),
#              size=2, show.legend=F, color="gray80") +
#   geom_pointrange(data=t8_allG.3, aes(x = rsCon, y=F.m, ymin = lower.se, ymax = upper.se),
#                   position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
#   facet_grid(.~ffa_type, scales="free_x", space = "free",
#              labeller = labeller(ffa_type = c("ffa_rs" = "FFA RS","ffa_re" = "FFA RE"))) +
#   scale_x_discrete(labels=c("RS","RE")) +
#   scale_fill_manual(values = c("#feb24c", "#91bfdb"), # c("#feb24c", "#91bfdb"),
#                     labels = c("FeedForward", "FeedBack")) +
#   coord_cartesian(ylim = c(0, 100), clip = "on") +
#   labs(x = "all VC", y = "Granger Causality F Value") +
#   theme_bw(base_size = 18) +
#   theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
#         axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
#         axis.line=element_line(),
#         strip.text.x = element_text(face = "plain", size = 15, color = "black"),
#         strip.background = element_blank(),
#         panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         panel.border = element_blank(),
#         panel.spacing=unit(1, "lines"),
#         plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
#         legend.title = element_blank(),
#         legend.position="top")
# #t8.all.plot8.5
# 
# t8.all.plot8.6 <- ggplot(data=t8_allL.3, aes(x=ffa_type, y=F, fill=dirt)) +
#   stat_summary(fun = mean, geom = "bar", position="dodge", na.rm = TRUE, alpha = .9, width = 0.8,  size = 1.02) +
#   geom_hline(yintercept=thr, linetype='dashed', color='gray60', alpha =1, size=1) +
#   geom_point(data=t8_allL.3, aes(x=ffa_type, y=F, fill=dirt), position = position_dodge(width=0.8),
#              size=2, show.legend=F, color="gray80") +
#   geom_pointrange(data=t8_allG.3, aes(x = ffa_type, y=F.m, ymin = lower.se, ymax = upper.se),
#                   position = position_dodge(0.80), color = "darkred", size = 1, show.legend = FALSE) +
#   facet_grid(.~rsCon, scales="free_x", space = "free",
#              labeller = labeller(rsCon = c("rs" = "all VC RS","re" = "all VC RE"))) +
#   scale_x_discrete(labels=c("RS","RE")) +
#   scale_fill_manual(values = c("#D2E6BD", "#4AA7B4"), # c("#feb24c", "#91bfdb"),
#                     labels = c("FeedForward", "Feedback")) +
#   coord_cartesian(ylim = c(0, 120), clip = "on") +
#   labs(x = "FFA", y = "Granger Causality F Value") +
#   theme_bw(base_size = 18) +
#   theme(axis.title = element_text(face = "bold", size = 16, color = "black"),
#         axis.text = element_text(face = "plain", hjust = 0.5, size = 15, color = "black"),
#         axis.line=element_line(),
#         strip.text.x = element_text(face = "plain", size = 15, color = "black"),
#         strip.background = element_blank(),
#         panel.grid.major = element_blank(),
#         panel.grid.minor = element_blank(),
#         panel.border = element_blank(),
#         panel.spacing=unit(1, "lines"),
#         plot.margin = margin(1, 0.3, 1, 0.3, "cm"), 
#         legend.title = element_blank(),
#         legend.position="top")
# #t8.all.plot8.6
# ggarrange(t8.all.plot8.5, t8.all.plot8.6,
#           ncol=2, labels=c("A","B"))

```

<br>
  
*시각 관심 영역(V4, all VC), FFA의 RS/RE, VC의 RS/RE를 요인으로 5 x 2 x 2 혼합 요인 분산분석을 수행하였다. 다른 것도 있지만, 주목할만한 점으로는 VC의 RS/RE와 FFA의 RS/RE 간의 상호작용이 유의하였다.*

<br>
  
  
```{r, collapse=TRUE}
t8_allL.3 <- t8_allL %>% filter(vRoi == "v4")
t8.aov1 <- aov_ez(id="subj", dv="F", data = t8_allL.3, within = c("rsCon", "ffa_type", "dirt"))
nice(t8.aov1, es="pes") %>% kable(digits=2)
```

<br>
  
  사후 분석 결과, FFA RS 에서 VC RS 와 VC RE 간 차이가 유의하였다.구체적으로 FFA RS-VC RS의 연결성 강도가 크게 나타났다.

<br>
  
```{r, collapse=TRUE}
t8.aov1.m2 <- emmeans(t8.aov1, pairwise ~ dirt | rsCon + ffa_type , adjust = "tukey") # adjust="bon" , "tukey", "none"
t8.aov1.m2$contrasts %>% kable(digits=3)
# plot(t8.aov1.m2, horizontal = T, comparison=T)

t8.aov1.m2 <- emmeans(t8.aov1, pairwise ~ dirt | ffa_type  + rsCon  , adjust = "tukey") # adjust="bon" , "tukey", "none"
t8.aov1.m2$contrasts %>% kable(digits=3)
# plot(t8.aov1.m2, horizontal = T, comparison=T)


t8.aov1.m2 <- emmeans(t8.aov1, pairwise ~ rsCon | dirt + ffa_type , adjust = "tukey") # adjust="bon" , "tukey", "none"
t8.aov1.m2$contrasts %>% kable(digits=3)
# plot(t8.aov1.m2, horizontal = T, comparison=T)

t8.aov1.m2 <- emmeans(t8.aov1, pairwise ~ rsCon | ffa_type + dirt , adjust = "tukey") # adjust="bon" , "tukey", "none"
t8.aov1.m2$contrasts %>% kable(digits=3)
# plot(t8.aov1.m2, horizontal = T, comparison=T)

t8.aov1.m2 <- emmeans(t8.aov1, pairwise ~ ffa_type | rsCon + dirt , adjust = "tukey") # adjust="bon" , "tukey", "none"
t8.aov1.m2$contrasts %>% kable(digits=3)
# plot(t8.aov1.m2, horizontal = T, comparison=T)

t8.aov1.m2 <- emmeans(t8.aov1, pairwise ~ ffa_type | dirt + rsCon , adjust = "tukey") # adjust="bon" , "tukey", "none"
t8.aov1.m2$contrasts %>% kable(digits=3)
# plot(t8.aov1.m2, horizontal = T, comparison=T)
```

<br>
  ~~
<br>

